<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STM Group â€” RFQ Configurator</title>
<link rel="icon" href="favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="lib/jszip.min.js"></script>
<script src="lib/FileSaver.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --o: #F94816; --oh: #e04214; --ol: #F6BD9A;
  --obg: rgba(249,72,22,.05);
  --dk: #22293B; --dk2: #314056;
  --gr: #CBCFD5; --lt: #F0F1F3; --wh: #FAFAFA;
  --bd: #3a3f4b; --r: 8px;
  --ss: 0 1px 4px rgba(34,41,59,.07);
  --tr: all .18s ease;
  --col-left: 320px;
  --col-right: 380px;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Outfit',sans-serif; background:var(--lt); color:var(--bd); min-height:100vh; overflow-x:hidden; }
::selection { background:var(--o); color:#fff; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hdr { background:var(--dk); height:56px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; position:sticky; top:0; z-index:200; }
.hdr-left { display:flex; align-items:center; gap:14px; }
.logo-grid { display:grid; grid-template-columns:repeat(3,6px); gap:2px; }
.logo-grid i { width:6px; height:6px; background:var(--o); border-radius:1px; display:block; }
.logo-txt { color:#fff; font-weight:700; font-size:16px; letter-spacing:.8px; line-height:1.1; }
.logo-txt small { color:var(--gr); font-weight:400; font-size:11px; display:block; letter-spacing:.3px; }
.hdr-right { display:flex; align-items:center; gap:10px; }

/* Language switcher */
.lang { display:flex; background:rgba(255,255,255,.06); border-radius:6px; overflow:hidden; border:1px solid rgba(255,255,255,.06); }
.lang button { padding:5px 10px; font-family:inherit; font-size:11px; font-weight:600; cursor:pointer; border:none; background:none; color:rgba(255,255,255,.4); transition:var(--tr); display:flex; align-items:center; gap:4px; }
.lang button:hover { color:rgba(255,255,255,.7); background:rgba(255,255,255,.04); }
.lang button.on { color:#fff; background:var(--o); }
.lang button .fl { font-size:13px; }

/* Buttons */
.btn { display:inline-flex; align-items:center; gap:6px; padding:7px 16px; border-radius:6px; font-family:inherit; font-weight:600; font-size:12px; cursor:pointer; border:none; transition:var(--tr); letter-spacing:.2px; }
.btn-o { background:var(--o); color:#fff; }
.btn-o:hover { background:var(--oh); transform:translateY(-1px); box-shadow:0 3px 10px rgba(249,72,22,.25); }
.btn-g { background:rgba(255,255,255,.08); color:rgba(255,255,255,.7); }
.btn-g:hover { background:rgba(255,255,255,.12); color:#fff; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THREE-COLUMN LAYOUT + RESIZABLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app { display:flex; height:calc(100vh - 56px - 32px); }

.col-left { width:var(--col-left); min-width:240px; max-width:500px; background:#fff; border-right:1px solid #e4e5e7; display:flex; flex-direction:column; overflow:hidden; flex-shrink:0; }
.col-mid { flex:1; min-width:300px; overflow:hidden; display:flex; flex-direction:column; }
.col-right { width:var(--col-right); min-width:260px; max-width:560px; background:var(--dk); flex-shrink:0; display:flex; flex-direction:column; overflow:hidden; }

/* Drag handles */
.drag-h { width:5px; cursor:col-resize; background:transparent; flex-shrink:0; position:relative; z-index:50; transition:background .15s; }
.drag-h:hover, .drag-h.dragging { background:var(--o); }
.drag-h::after { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:3px; height:32px; border-radius:2px; background:var(--gr); opacity:.4; transition:opacity .15s; }
.drag-h:hover::after { opacity:0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEFT SIDEBAR â€” Project & Chapters
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.left-scroll { flex:1; overflow-y:auto; }
.sect { padding:16px 18px; border-bottom:1px solid #eee; }
.sect h3 { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:1.5px; color:var(--dk2); margin-bottom:12px; }
.pf { margin-bottom:10px; }
.pf label { display:block; font-size:11px; font-weight:500; color:#777; margin-bottom:3px; }
.pf input, .pf select { width:100%; padding:7px 10px; border:1px solid #ddd; border-radius:5px; font-family:inherit; font-size:13px; background:var(--wh); transition:var(--tr); }
.pf input:focus, .pf select:focus { outline:none; border-color:var(--o); box-shadow:0 0 0 2px rgba(249,72,22,.1); }

/* Chapter groups */
.ch-group { border-bottom:1px solid #eee; }
.ch-head { display:flex; align-items:center; gap:8px; padding:10px 18px; cursor:pointer; transition:var(--tr); user-select:none; }
.ch-head:hover { background:var(--obg); }
.ch-num { font-size:11px; font-weight:800; color:var(--o); min-width:20px; }
.ch-title { font-size:13px; font-weight:600; color:var(--dk); flex:1; }
.ch-count { font-size:10px; color:#999; background:var(--lt); padding:2px 7px; border-radius:10px; }
.ch-arrow { font-size:10px; color:#bbb; transition:transform .2s; }
.ch-group.open .ch-arrow { transform:rotate(90deg); }
.ch-blocks { display:none; padding:0 10px 6px 10px; }
.ch-group.open .ch-blocks { display:block; }

/* Block items */
.blk { display:flex; align-items:flex-start; gap:8px; padding:8px 10px; border-radius:6px; cursor:pointer; transition:var(--tr); border:1px solid transparent; margin-bottom:2px; }
.blk:hover { background:var(--obg); }
.blk.sel { background:var(--obg); border-color:rgba(249,72,22,.2); }
.blk-ck { width:16px; height:16px; border:2px solid #ccc; border-radius:3px; flex-shrink:0; margin-top:1px; display:flex; align-items:center; justify-content:center; transition:var(--tr); font-size:9px; }
.blk.sel .blk-ck { background:var(--o); border-color:var(--o); color:#fff; }
.blk-info h4 { font-size:12px; font-weight:600; color:var(--dk); line-height:1.3; }
.blk-info p { font-size:10px; color:#999; margin-top:1px; }
.blk-badge { font-size:8px; font-weight:700; text-transform:uppercase; letter-spacing:.5px; padding:2px 5px; border-radius:3px; white-space:nowrap; margin-top:2px; flex-shrink:0; }
.blk-badge.req { background:var(--o); color:#fff; }
.blk-badge.opt { background:var(--lt); color:#999; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MIDDLE â€” Variable Forms
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mid-scroll { flex:1; overflow-y:auto; padding:20px 24px; }
.empty-state { display:flex; flex-direction:column; align-items:center; justify-content:center; height:50vh; text-align:center; color:#aaa; }
.empty-state .icon { font-size:40px; opacity:.3; margin-bottom:12px; }
.empty-state h2 { font-size:17px; color:#888; margin-bottom:6px; }
.empty-state p { font-size:13px; max-width:280px; }

/* Variable section */
.var-sect { background:#fff; border-radius:var(--r); padding:20px; margin-bottom:14px; box-shadow:var(--ss); border:1px solid #e8e9eb; animation:fadeUp .25s ease; }
@keyframes fadeUp { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }
.var-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; padding-bottom:10px; border-bottom:2px solid var(--o); gap:10px; }
.var-head h3 { font-size:14px; font-weight:700; color:var(--dk); }
.var-head-right { display:flex; align-items:center; gap:8px; }
.scope-tag { font-size:10px; font-weight:600; padding:3px 8px; border-radius:12px; background:#e8f5e9; color:#2e7d32; white-space:nowrap; }
.scope-tag.warn { background:#fff3e0; color:#e65100; }

/* Delegate entire block toggle */
.del-block { display:flex; align-items:center; gap:5px; cursor:pointer; font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:.4px; color:#aaa; transition:var(--tr); user-select:none; padding:3px 8px; border-radius:4px; border:1px solid #eee; }
.del-block:hover { color:var(--o); border-color:rgba(249,72,22,.3); }
.del-block.on { color:#fff; background:var(--o); border-color:var(--o); }
.del-block .ck { width:12px; height:12px; border:1.5px solid currentColor; border-radius:2px; display:flex; align-items:center; justify-content:center; font-size:7px; }
.del-block.on .ck { background:#fff; color:var(--o); }

/* Variable grid */
.var-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(180px, 1fr)); gap:12px; }
.var-grid.delegated { opacity:.3; pointer-events:none; }
.vf label { display:block; font-size:11px; font-weight:500; color:#666; margin-bottom:3px; }
.vf label .u { color:var(--o); font-weight:600; }
.vf input, .vf select { width:100%; padding:7px 10px; border:1px solid #ddd; border-radius:5px; font-family:inherit; font-size:13px; transition:var(--tr); }
.vf input:focus, .vf select:focus { outline:none; border-color:var(--o); box-shadow:0 0 0 2px rgba(249,72,22,.1); }
.vf input::placeholder { color:#ccc; }
/* Per-variable supplier toggle */
.sup-row { display:flex; align-items:center; justify-content:space-between; }
.sup-btn { display:flex; align-items:center; gap:3px; cursor:pointer; font-size:9px; font-weight:600; text-transform:uppercase; letter-spacing:.4px; color:#bbb; transition:var(--tr); user-select:none; }
.sup-btn:hover { color:var(--o); }
.sup-btn.on { color:var(--o); }
.sup-btn .sc { width:12px; height:12px; border:1.5px solid #ccc; border-radius:2px; display:flex; align-items:center; justify-content:center; font-size:7px; transition:var(--tr); }
.sup-btn.on .sc { background:var(--o); border-color:var(--o); color:#fff; }
.vf.sup-set input, .vf.sup-set select { opacity:.3; pointer-events:none; background:#f7f7f7; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RIGHT SIDEBAR â€” Live Preview
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.right-scroll { flex:1; overflow-y:auto; }
.pv-head { padding:14px 18px; border-bottom:1px solid rgba(255,255,255,.08); display:flex; align-items:center; justify-content:space-between; }
.pv-head h3 { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1.5px; color:var(--o); }
.pv-head .cnt { font-size:11px; color:#666; }
.pv-body { padding:16px 18px; }
.pv-ch { margin-bottom:16px; padding-bottom:12px; border-bottom:1px solid rgba(255,255,255,.06); }
.pv-ch:last-child { border-bottom:none; }
.pv-ch-head { font-size:11px; font-weight:700; color:var(--o); margin-bottom:6px; text-transform:uppercase; letter-spacing:.5px; }
.pv-blk { margin-bottom:10px; }
.pv-blk-title { font-size:11px; font-weight:600; color:#8899aa; margin-bottom:3px; }
.pv-blk-txt { font-size:12px; line-height:1.65; color:#bcc3cc; white-space:pre-wrap; }
.pv-blk-txt .vh { color:var(--ol); font-weight:600; background:rgba(249,72,22,.1); padding:1px 4px; border-radius:2px; }
.pv-blk-txt .ve { color:#f94816; background:rgba(249,72,22,.12); padding:1px 5px; border-radius:2px; font-style:italic; font-size:11px; }
.pv-blk-txt .vs { color:#64b5f6; background:rgba(100,181,246,.1); padding:1px 5px; border-radius:2px; font-style:italic; font-size:11px; }
.pv-blk-del { color:#64b5f6; font-style:italic; font-size:11px; padding:4px 8px; background:rgba(100,181,246,.08); border-radius:4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATUS BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sbar { background:var(--dk); border-top:1px solid rgba(255,255,255,.08); height:32px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; font-size:11px; color:#666; }
.sbar .left { display:flex; gap:18px; }
.sbar .dot { width:5px; height:5px; border-radius:50%; background:#4caf50; display:inline-block; margin-right:5px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBARS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:#d0d0d0; border-radius:3px; }
.col-right ::-webkit-scrollbar-thumb { background:#444; }

/* Responsive */
@media (max-width:1100px) {
  .col-right { display:none; }
  .app { --col-right:0px; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="hdr">
  <div class="hdr-left">
    <div class="logo-grid"><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i></div>
    <div class="logo-txt">STM GROUP <small id="ui-sub"></small></div>
  </div>
  <div class="hdr-right">
    <div class="lang" id="lang-bar"></div>
    <button class="btn btn-g" onclick="resetAll()" id="btn-r"></button>
    <button class="btn btn-o" onclick="exportToWord()" id="btn-e"></button>
  </div>
</header>

<!-- THREE-COLUMN LAYOUT -->
<div class="app" id="app">
  <!-- LEFT: Project details + chapter/block selection -->
  <aside class="col-left" id="col-left">
    <div class="left-scroll">
      <div class="sect">
        <h3 id="ui-pt"></h3>
        <div class="pf"><label id="lbl-pn"></label><input type="text" id="proj-name" placeholder="Nieuwbouw Distributiecentrum Breda" oninput="upd()"></div>
        <div class="pf"><label id="lbl-pc"></label><input type="text" id="proj-code" placeholder="STP25-0847" oninput="upd()"></div>
        <div class="pf"><label id="lbl-scope"></label><input type="text" id="proj-scope" placeholder="Montage dakbeplating en gevelbekleding" oninput="upd()"></div>
        <div class="pf"><label id="lbl-rfq"></label>
          <div style="display:flex;gap:6px">
            <input type="text" id="proj-rfq" placeholder="RFQ-2025-0001" oninput="upd()" style="flex:1">
            <button class="btn btn-g" onclick="genRfqNum()" style="padding:6px 10px;font-size:11px;background:var(--lt);color:var(--dk2);border:1px solid #ddd;white-space:nowrap" title="Auto-generate">âŸ³ Auto</button>
          </div>
        </div>
        <div class="pf"><label id="lbl-pd"></label><input type="date" id="proj-date" oninput="upd()"></div>
      </div>
      <div class="sect">
        <h3 id="ui-st"></h3>
        <p style="font-size:11px;color:#aaa;margin-bottom:8px" id="ui-sh"></p>
      </div>
      <div id="ch-list"></div>
    </div>
  </aside>

  <!-- DRAG HANDLE LEFT -->
  <div class="drag-h" id="drag-left"></div>

  <!-- MIDDLE: Variable forms -->
  <main class="col-mid">
    <div class="mid-scroll" id="mid-scroll">
      <div class="empty-state" id="empty-s">
        <div class="icon">ğŸ“‹</div>
        <h2 id="ui-et"></h2>
        <p id="ui-eh"></p>
      </div>
      <div id="var-forms"></div>
    </div>
  </main>

  <!-- DRAG HANDLE RIGHT -->
  <div class="drag-h" id="drag-right"></div>

  <!-- RIGHT: Live preview -->
  <aside class="col-right" id="col-right">
    <div class="pv-head">
      <h3 id="ui-pvt"></h3>
      <span class="cnt" id="pv-cnt"></span>
    </div>
    <div class="right-scroll">
      <div class="pv-body" id="pv-body"></div>
    </div>
  </aside>
</div>

<!-- STATUS BAR -->
<div class="sbar">
  <div class="left">
    <span><span class="dot"></span><span id="ui-sr"></span></span>
    <span id="st-b"></span>
    <span id="st-v"></span>
  </div>
  <span>STM Group â€” RFQ Configurator v3.0</span>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI STRINGS â€” NL (master), EN, DE, SK, FA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LANGS = [
  {code:'nl', flag:'ğŸ‡³ğŸ‡±', label:'NL'},
  {code:'en', flag:'ğŸ‡¬ğŸ‡§', label:'EN'},
  {code:'de', flag:'ğŸ‡©ğŸ‡ª', label:'DE'},
  {code:'sk', flag:'ğŸ‡¸ğŸ‡°', label:'SK'},
  {code:'fa', flag:'ğŸ‡®ğŸ‡·', label:'FA'},
];

const UI = {
nl:{
  sub:'Offerte Configurator â€” PG08 Montage',
  btnR:'â†» Reset', btnE:'â¬‡ Word Export',
  pt:'Projectgegevens', pn:'Projectnaam', pc:'Projectcode', scope:'Scope omschrijving', rfq:'RFQ Nummer', pd:'Datum',
  st:'Hoofdstukken & Tekstblokken', sh:'Selecteer de scope-items voor deze aanvraag.',
  et:'Selecteer tekstblokken', eh:'Kies items uit het linkerpaneel. De variabelen verschijnen hier.',
  pvt:'Live Voorbeeld', sr:'Gereed',
  bsel:'blokken geselecteerd', vfil:'variabelen ingevuld', bk:'blokken',
  req:'Verplicht', opt:'Optioneel', sel:'â€” kies â€”',
  io:'Alleen montage', si:'Leveren & Monteren', sv:'Scope varieert',
  supBtn:'Leverancier', supFull:'Door leverancier op te geven',
  delAll:'Geheel door leverancier',
  dS:'Geachte heer/mevrouw,',
  dI:'Graag ontvangen wij uw prijsopgave voor onderstaande werkzaamheden conform de bijgevoegde projectdocumentatie.',
  dC:'Wij verzoeken u uw prijsopgave per onderdeel te specificeren.',
  dG:'Met vriendelijke groet,',
},
en:{
  sub:'RFQ Configurator â€” PG08 Erection',
  btnR:'â†» Reset', btnE:'â¬‡ Word Export',
  pt:'Project Details', pn:'Project Name', pc:'Project Code', scope:'Scope Description', rfq:'RFQ Number', pd:'Date',
  st:'Chapters & Text Blocks', sh:'Select the scope items for this request.',
  et:'Select text blocks', eh:'Choose items from the left panel. Variables will appear here.',
  pvt:'Live Preview', sr:'Ready',
  bsel:'blocks selected', vfil:'variables filled', bk:'blocks',
  req:'Required', opt:'Optional', sel:'â€” select â€”',
  io:'Install only', si:'Supply & Install', sv:'Scope varies',
  supBtn:'Supplier', supFull:'To be specified by supplier',
  delAll:'Entire block by supplier',
  dS:'Dear Sir/Madam,',
  dI:'We would like to receive your quotation for the works described below in accordance with the enclosed project documentation.',
  dC:'Please provide your pricing per scope item.',
  dG:'Kind regards,',
},
de:{
  sub:'Angebotsanfrage â€” PG08 Montage',
  btnR:'â†» ZurÃ¼cksetzen', btnE:'â¬‡ Word Export',
  pt:'Projektdaten', pn:'Projektname', pc:'Projektcode', scope:'Leistungsbeschreibung', rfq:'Anfragenummer', pd:'Datum',
  st:'Kapitel & Textbausteine', sh:'WÃ¤hlen Sie die Leistungspositionen fÃ¼r diese Anfrage.',
  et:'Textbausteine auswÃ¤hlen', eh:'WÃ¤hlen Sie im linken Bereich. Variablen erscheinen hier.',
  pvt:'Live-Vorschau', sr:'Bereit',
  bsel:'Bausteine ausgewÃ¤hlt', vfil:'Variablen ausgefÃ¼llt', bk:'Bausteine',
  req:'Pflicht', opt:'Optional', sel:'â€” wÃ¤hlen â€”',
  io:'Nur Montage', si:'Liefern & Montieren', sv:'Umfang variiert',
  supBtn:'Lieferant', supFull:'Vom Lieferanten anzugeben',
  delAll:'Gesamter Baustein vom Lieferanten',
  dS:'Sehr geehrte Damen und Herren,',
  dI:'Wir bitten um Ihr Angebot fÃ¼r die nachfolgend beschriebenen Leistungen gemÃ¤ÃŸ der beigefÃ¼gten Projektdokumentation.',
  dC:'Bitte geben Sie Ihre Preise je Leistungsposition an.',
  dG:'Mit freundlichen GrÃ¼ÃŸen,',
},
sk:{
  sub:'KonfigurÃ¡tor ponÃºk â€” PG08 MontÃ¡Å¾',
  btnR:'â†» Reset', btnE:'â¬‡ Word Export',
  pt:'Ãšdaje o projekte', pn:'NÃ¡zov projektu', pc:'KÃ³d projektu', scope:'Popis rozsahu', rfq:'ÄŒÃ­slo Å¾iadosti', pd:'DÃ¡tum',
  st:'Kapitoly a textovÃ© bloky', sh:'Vyberte poloÅ¾ky rozsahu pre tÃºto Å¾iadosÅ¥.',
  et:'Vyberte textovÃ© bloky', eh:'Vyberte poloÅ¾ky z Ä¾avÃ©ho panela. Tu sa zobrazia premennÃ©.',
  pvt:'Å½ivÃ½ nÃ¡hÄ¾ad', sr:'PripravenÃ½',
  bsel:'blokov vybranÃ½ch', vfil:'premennÃ½ch vyplnenÃ½ch', bk:'blokov',
  req:'PovinnÃ©', opt:'VoliteÄ¾nÃ©', sel:'â€” vyberte â€”',
  io:'Len montÃ¡Å¾', si:'DodÃ¡vka a montÃ¡Å¾', sv:'Rozsah sa lÃ­Å¡i',
  supBtn:'DodÃ¡vateÄ¾', supFull:'UrÄÃ­ dodÃ¡vateÄ¾',
  delAll:'CelÃ½ blok urÄÃ­ dodÃ¡vateÄ¾',
  dS:'VÃ¡Å¾enÃ½ pane/VÃ¡Å¾enÃ¡ pani,',
  dI:'Radi by sme od vÃ¡s dostali cenovÃº ponuku na niÅ¾Å¡ie opÃ­sanÃ© prÃ¡ce.',
  dC:'ProsÃ­me o uvedenie cien za jednotlivÃ© poloÅ¾ky.',
  dG:'S pozdravom,',
},
fa:{
  sub:'Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‚ÛŒÙ…Øª â€” PG08 Ù…ÙˆÙ†ØªØ§Ú˜',
  btnR:'â†» Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ', btnE:'â¬‡ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ±Ø¯',
  pt:'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡', pn:'Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡', pc:'Ú©Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡', scope:'Ø´Ø±Ø­ Ù…Ø­Ø¯ÙˆØ¯Ù‡', rfq:'Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª', pd:'ØªØ§Ø±ÛŒØ®',
  st:'ÙØµÙ„â€ŒÙ‡Ø§ Ùˆ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ', sh:'Ù…ÙˆØ§Ø±Ø¯ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.',
  et:'Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', eh:'Ø§Ø² Ù¾Ù†Ù„ Ø³Ù…Øª Ú†Ù¾ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ù…ØªØºÛŒØ±Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.',
  pvt:'Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡', sr:'Ø¢Ù…Ø§Ø¯Ù‡',
  bsel:'Ø¨Ù„ÙˆÚ© Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡', vfil:'Ù…ØªØºÛŒØ± ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡', bk:'Ø¨Ù„ÙˆÚ©',
  req:'Ø§Ù„Ø²Ø§Ù…ÛŒ', opt:'Ø§Ø®ØªÛŒØ§Ø±ÛŒ', sel:'â€” Ø§Ù†ØªØ®Ø§Ø¨ â€”',
  io:'ÙÙ‚Ø· Ù†ØµØ¨', si:'ØªØ§Ù…ÛŒÙ† Ùˆ Ù†ØµØ¨', sv:'Ø¯Ø§Ù…Ù†Ù‡ Ù…ØªØºÛŒØ±',
  supBtn:'ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡', supFull:'ØªÙˆØ³Ø· ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯',
  delAll:'Ú©Ù„ Ø¨Ù„ÙˆÚ© ØªÙˆØ³Ø· ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡',
  dS:'Ø¨Ø§ Ø§Ø­ØªØ±Ø§Ù…ØŒ',
  dI:'Ø®ÙˆØ§Ù‡Ø´Ù…Ù†Ø¯ Ø§Ø³Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù‚ÛŒÙ…Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø´Ø±Ø­ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± Ø²ÛŒØ± Ø§Ø±Ø§Ø¦Ù‡ ÙØ±Ù…Ø§ÛŒÛŒØ¯.',
  dC:'Ù„Ø·ÙØ§Ù‹ Ù‚ÛŒÙ…Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ù‡Ø± Ø¨Ø®Ø´ Ø§Ø¹Ù„Ø§Ù… ÙØ±Ù…Ø§ÛŒÛŒØ¯.',
  dG:'Ø¨Ø§ ØªØ´Ú©Ø±ØŒ',
}};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHAPTERS (numbered, THQ-style)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHAPTERS = [
  { id:'CH1', num:'1', ti:{nl:'Inleiding',en:'Introduction',de:'Einleitung',sk:'Ãšvod',fa:'Ù…Ù‚Ø¯Ù…Ù‡'} },
  { id:'CH2', num:'2', ti:{nl:'Scope van levering',en:'Scope of Supply',de:'Lieferumfang',sk:'Rozsah dodÃ¡vky',fa:'Ù…Ø­Ø¯ÙˆØ¯Ù‡ ØªØ­ÙˆÛŒÙ„'} },
  { id:'CH3', num:'3', ti:{nl:'Standaarden',en:'Standards',de:'Standards',sk:'Å tandardy',fa:'Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§'} },
  { id:'CH4', num:'4', ti:{nl:'Normering',en:'Regulations',de:'Normung',sk:'Normy',fa:'Ù…Ù‚Ø±Ø±Ø§Øª'} },
  { id:'CH5', num:'5', ti:{nl:'Bouwplaatsvoorzieningen',en:'Site Provisions',de:'Baustelleneinrichtung',sk:'Zariadenie staveniska',fa:'ØªØ¬Ù‡ÛŒØ²Ø§Øª Ú©Ø§Ø±Ú¯Ø§Ù‡'} },
  { id:'CH6', num:'6', ti:{nl:'Uitgangspunten',en:'Conditions',de:'Rahmenbedingungen',sk:'Podmienky',fa:'Ø´Ø±Ø§ÛŒØ·'} },
  { id:'CH7', num:'7', ti:{nl:'Transport en logistiek',en:'Transport & Logistics',de:'Transport & Logistik',sk:'Doprava a logistika',fa:'Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„'} },
  { id:'CH8', num:'8', ti:{nl:'CommerciÃ«le voorwaarden',en:'Commercial Terms',de:'KaufmÃ¤nnische Bedingungen',sk:'ObchodnÃ© podmienky',fa:'Ø´Ø±Ø§ÛŒØ· Ø¨Ø§Ø²Ø±Ú¯Ø§Ù†ÛŒ'} },
  { id:'CH9', num:'9', ti:{nl:'Exclusief',en:'Exclusions',de:'AusschlÃ¼sse',sk:'VylÃºÄenia',fa:'Ù…ÙˆØ§Ø±Ø¯ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡'} },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TEXT BLOCKS â€” mapped to chapters
//  (placeholder content â€” will be replaced
//   with proper Dutch text from text block chat)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TB = [
// --- CH2: Scope ---
{id:'TB-ROOF-01',ch:'CH2',mand:true,sl:'install_only',
 ti:{nl:'Dakplaten montage',en:'Roof Plate Installation',de:'Dachplatenmontage',sk:'MontÃ¡Å¾ streÅ¡nÃ½ch panelov',fa:'Ù†ØµØ¨ ÙˆØ±Ù‚â€ŒÙ‡Ø§ÛŒ Ø³Ù‚Ù'},
 ds:{nl:'Montage dakplaten',en:'Mounting roof plates',de:'Montage Dachplatten',sk:'MontÃ¡Å¾ streÅ¡nÃ½ch dosiek',fa:'Ù…ÙˆÙ†ØªØ§Ú˜ ØµÙØ­Ø§Øª Ø³Ù‚Ù'},
 tp:{
  nl:'Montage van de dakplaten door Staalmeesters geleverd.\nCirca {qty_m2} mÂ² sendzimir verzinkte stalen dakplaten.\nType {profile_type}, {thickness_mm} mm dik.\nZichtzijde voorzien van {interior_coating}.\nDakplaat is {perforated}.\nBevestiging d.m.v. schietnagels, onderlinge bevestiging d.m.v. teksen h.o.h. {screw_spacing_mm} mm.',
  en:'Installation of roof plates supplied by Staalmeesters.\nApprox. {qty_m2} mÂ² sendzimir galvanised steel roof plates.\nType {profile_type}, {thickness_mm} mm thick.\nVisible side with {interior_coating}.\nRoof plate is {perforated}.\nFastening by shot nails, lateral fastening by self-tapping screws c/c {screw_spacing_mm} mm.',
  de:'Montage der von Staalmeesters gelieferten Dachplatten.\nCa. {qty_m2} mÂ² sendzimir-verzinkte Stahldachplatten.\nTyp {profile_type}, {thickness_mm} mm dick.\nSichtseite mit {interior_coating}.\nDachplatte ist {perforated}.\nBefestigung mittels SchussnÃ¤geln, LÃ¤ngsbefestigung durch Bohrschrauben Abstand {screw_spacing_mm} mm.',
  sk:'MontÃ¡Å¾ streÅ¡nÃ½ch dosiek dodanÃ½ch spoloÄnosÅ¥ou Staalmeesters.\nCca {qty_m2} mÂ² sendzimÃ­rovo pozinkovanÃ½ch oceÄ¾ovÃ½ch streÅ¡nÃ½ch dosiek.\nTyp {profile_type}, {thickness_mm} mm hrubÃ©.\nPohÄ¾adovÃ¡ strana s {interior_coating}.\nStreÅ¡nÃ¡ doska je {perforated}.\nUpevnenie strelnÃ½mi klincami, vzÃ¡jomnÃ© upevnenie samoreznÃ½mi skrutkami po {screw_spacing_mm} mm.',
  fa:'Ù†ØµØ¨ ÙˆØ±Ù‚â€ŒÙ‡Ø§ÛŒ Ø³Ù‚ÙÛŒ ØªØ§Ù…ÛŒÙ† Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Staalmeesters.\nØ­Ø¯ÙˆØ¯ {qty_m2} Ù…ØªØ± Ù…Ø±Ø¨Ø¹ ÙˆØ±Ù‚ ÙÙˆÙ„Ø§Ø¯ÛŒ Ø³Ù‚ÙÛŒ.\nÙ†ÙˆØ¹ {profile_type}ØŒ Ø¶Ø®Ø§Ù…Øª {thickness_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±.\nØ±ÙˆÚ©Ø´ Ø¯Ø§Ø®Ù„ÛŒ: {interior_coating}.\nÙˆØ±Ù‚ Ø³Ù‚Ù {perforated} Ø§Ø³Øª.\nØ§ØªØµØ§Ù„ Ø¨Ø§ Ù…ÛŒØ®â€ŒÙ¾Ø±Ú†ØŒ Ø§ØªØµØ§Ù„ Ø¬Ø§Ù†Ø¨ÛŒ Ø¨Ø§ Ù¾ÛŒÚ†â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ§ØµÙ„Ù‡ {screw_spacing_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±.'
 },
 vars:[
  {n:'qty_m2',l:{nl:'Dakoppervlak',en:'Roof area',de:'DachflÃ¤che',sk:'Plocha strechy',fa:'Ù…Ø³Ø§Ø­Øª Ø³Ù‚Ù'},u:'mÂ²',t:'number',ph:'960'},
  {n:'profile_type',l:{nl:'Profieltype',en:'Profile type',de:'Profiltyp',sk:'Typ profilu',fa:'Ù†ÙˆØ¹ Ù¾Ø±ÙˆÙÛŒÙ„'},u:'',t:'select',opts:['SAB 135R/930','SAB 106R/1060','SAB 85R/1142']},
  {n:'thickness_mm',l:{nl:'Staaldikte',en:'Steel thickness',de:'Stahldicke',sk:'HrÃºbka ocele',fa:'Ø¶Ø®Ø§Ù…Øª ÙÙˆÙ„Ø§Ø¯'},u:'mm',t:'number',ph:'0.88'},
  {n:'interior_coating',l:{nl:'Interieurcoating',en:'Interior coating',de:'Innenbeschichtung',sk:'VnÃºtornÃ½ nÃ¡ter',fa:'Ø±ÙˆÚ©Ø´ Ø¯Ø§Ø®Ù„ÛŒ'},u:'',t:'text',ph:'interieurcoating'},
  {n:'perforated',l:{nl:'Geperforeerd?',en:'Perforated?',de:'Perforiert?',sk:'PerforovanÃ©?',fa:'Ø³ÙˆØ±Ø§Ø®â€ŒØ¯Ø§Ø±ØŸ'},u:'',t:'select',opts:['niet geperforeerd','geperforeerd']},
  {n:'screw_spacing_mm',l:{nl:'Schroefafstand',en:'Screw spacing',de:'Schraubenabstand',sk:'Rozstup skrutiek',fa:'ÙØ§ØµÙ„Ù‡ Ù¾ÛŒÚ†'},u:'mm',t:'number',ph:'500'},
]},
{id:'TB-ROOF-02',ch:'CH2',mand:true,sl:'varies',
 ti:{nl:'Mastiekhoeken',en:'Mastic Angles',de:'Mastixwinkel',sk:'TmelovÃ© uhly',fa:'Ø²ÙˆØ§ÛŒØ§ÛŒ Ù…Ø§Ø³ØªÛŒÚ©'},
 ds:{nl:'Nok-/goot afdichtstroken',en:'Ridge/eave sealing strips',de:'First-/Traufabdichtungen',sk:'HrebeÅˆovÃ©/odkvapovÃ© tesnenia',fa:'Ù†ÙˆØ§Ø±Ù‡Ø§ÛŒ Ø¢Ø¨â€ŒØ¨Ù†Ø¯ÛŒ'},
 tp:{
  nl:'Circa {qty_m1} mÂ¹ sendzimir verzinkte stalen mastiekhoeken, max. ontw. breedte {width_mm} mm, {thickness_mm} mm dik.',
  en:'Approx. {qty_m1} mÂ¹ sendzimir galvanised steel mastic angles, max. dev. width {width_mm} mm, {thickness_mm} mm thick.',
  de:'Ca. {qty_m1} mÂ¹ sendzimir-verzinkte Stahl-Mastixwinkel, max. abg. Breite {width_mm} mm, {thickness_mm} mm dick.',
  sk:'Cca {qty_m1} mÂ¹ sendzimÃ­rovo pozinkovanÃ½ch oceÄ¾ovÃ½ch tmelovÃ½ch uhlov, max. rozvinutÃ¡ Å¡Ã­rka {width_mm} mm, {thickness_mm} mm hrubÃ©.',
  fa:'Ø­Ø¯ÙˆØ¯ {qty_m1} Ù…ØªØ± Ø·ÙˆÙ„ Ø²ÙˆØ§ÛŒØ§ÛŒ Ù…Ø§Ø³ØªÛŒÚ© ÙÙˆÙ„Ø§Ø¯ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ {width_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±ØŒ Ø¶Ø®Ø§Ù…Øª {thickness_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±.'
 },
 vars:[
  {n:'qty_m1',l:{nl:'Lengte',en:'Length',de:'LÃ¤nge',sk:'DÄºÅ¾ka',fa:'Ø·ÙˆÙ„'},u:'mÂ¹',t:'number',ph:'128'},
  {n:'width_mm',l:{nl:'Ontw. breedte',en:'Dev. width',de:'Abg. Breite',sk:'Rozv. Å¡Ã­rka',fa:'Ø¹Ø±Ø¶'},u:'mm',t:'number',ph:'250'},
  {n:'thickness_mm',l:{nl:'Dikte',en:'Thickness',de:'Dicke',sk:'HrÃºbka',fa:'Ø¶Ø®Ø§Ù…Øª'},u:'mm',t:'number',ph:'0.75'},
]},
{id:'TB-ROOF-03',ch:'CH2',mand:true,sl:'supply_install',
 ti:{nl:'Veiligheidsvoorzieningen',en:'Safety Provisions',de:'Sicherheitseinrichtungen',sk:'BezpeÄnostnÃ© opatrenia',fa:'ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§ÛŒÙ…Ù†ÛŒ'},
 ds:{nl:'Veiligheidsnetten & randbeveiliging',en:'Safety nets & edge protection',de:'Sicherheitsnetze & Randsicherung',sk:'Siete a ochrana hrÃ¡n',fa:'ØªÙˆØ± Ø§ÛŒÙ…Ù†ÛŒ Ùˆ Ø­ÙØ§Ø¸Øª Ù„Ø¨Ù‡'},
 tp:{
  nl:'Inclusief veiligheidsvoorzieningen:\nCirca {nets_m2} mÂ² veiligheidsnetten, huurprijs max. {nets_days} werkdagen.\nCirca {edge_m1} mÂ¹ randbeveiliging, huurprijs max. {edge_days} werkdagen.',
  en:'Including safety provisions:\nApprox. {nets_m2} mÂ² safety nets, rental max. {nets_days} working days.\nApprox. {edge_m1} mÂ¹ edge protection, rental max. {edge_days} working days.',
  de:'Inklusive Sicherheitseinrichtungen:\nCa. {nets_m2} mÂ² Sicherheitsnetze, Miete max. {nets_days} Arbeitstage.\nCa. {edge_m1} mÂ¹ Randsicherung, Miete max. {edge_days} Arbeitstage.',
  sk:'VrÃ¡tane bezpeÄnostnÃ½ch opatrenÃ­:\nCca {nets_m2} mÂ² bezpeÄnostnÃ½ch sietÃ­, prenÃ¡jom max. {nets_days} pracovnÃ½ch dnÃ­.\nCca {edge_m1} mÂ¹ ochrany hrÃ¡n, prenÃ¡jom max. {edge_days} pracovnÃ½ch dnÃ­.',
  fa:'Ø´Ø§Ù…Ù„ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§ÛŒÙ…Ù†ÛŒ:\nØ­Ø¯ÙˆØ¯ {nets_m2} Ù…ØªØ± Ù…Ø±Ø¨Ø¹ ØªÙˆØ± Ø§ÛŒÙ…Ù†ÛŒØŒ Ø§Ø¬Ø§Ø±Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± {nets_days} Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ.\nØ­Ø¯ÙˆØ¯ {edge_m1} Ù…ØªØ± Ø·ÙˆÙ„ Ø­ÙØ§Ø¸Øª Ù„Ø¨Ù‡ØŒ Ø§Ø¬Ø§Ø±Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± {edge_days} Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ.'
 },
 vars:[
  {n:'nets_m2',l:{nl:'Netten oppervlak',en:'Nets area',de:'NetzflÃ¤che',sk:'Plocha sietÃ­',fa:'Ù…Ø³Ø§Ø­Øª ØªÙˆØ±'},u:'mÂ²',t:'number',ph:'960'},
  {n:'nets_days',l:{nl:'Huurperiode netten',en:'Nets rental',de:'Mietdauer Netze',sk:'PrenÃ¡jom sietÃ­',fa:'Ø§Ø¬Ø§Ø±Ù‡ ØªÙˆØ±'},u:{nl:'dagen',en:'days',de:'Tage',sk:'dnÃ­',fa:'Ø±ÙˆØ²'},t:'number',ph:'15'},
  {n:'edge_m1',l:{nl:'Randbeveiliging',en:'Edge protection',de:'Randsicherung',sk:'Ochrana hrÃ¡n',fa:'Ø­ÙØ§Ø¸Øª Ù„Ø¨Ù‡'},u:'mÂ¹',t:'number',ph:'130'},
  {n:'edge_days',l:{nl:'Huurperiode rand',en:'Edge rental',de:'Mietdauer Rand',sk:'PrenÃ¡jom ochrany',fa:'Ø§Ø¬Ø§Ø±Ù‡ Ø­ÙØ§Ø¸Øª'},u:{nl:'dagen',en:'days',de:'Tage',sk:'dnÃ­',fa:'Ø±ÙˆØ²'},t:'number',ph:'25'},
]},
{id:'TB-WALL-01',ch:'CH2',mand:true,sl:'install_only',
 ti:{nl:'Sandwichpanelen montage',en:'Sandwich Panel Installation',de:'Sandwichplattenmontage',sk:'MontÃ¡Å¾ sendviÄovÃ½ch panelov',fa:'Ù†ØµØ¨ Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù†Ø¯ÙˆÛŒÚ†ÛŒ'},
 ds:{nl:'Montage geÃ¯soleerde gevelpanelen',en:'Mounting insulated wall panels',de:'Montage Wandpaneele',sk:'MontÃ¡Å¾ izolovanÃ½ch panelov',fa:'Ù†ØµØ¨ Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø¹Ø§ÛŒÙ‚'},
 tp:{
  nl:'Het monteren van circa {qty_m2} mÂ² sendzimir verzinkte geÃ¯soleerde gevelpanelen.\n{orientation} gemonteerd.\nDikte: {thickness_mm} mm. Werkende breedte: {working_width_mm} mm.\nBuitenplaat: {outer_thickness_mm} mm, {outer_coating} RAL {ral_outer}.\nBinnenplaat: {inner_thickness_mm} mm, {inner_coating}.\nKern: {core_type}.',
  en:'Installation of approx. {qty_m2} mÂ² insulated facade panels.\nMounted {orientation}.\nThickness: {thickness_mm} mm. Working width: {working_width_mm} mm.\nOuter sheet: {outer_thickness_mm} mm, {outer_coating} RAL {ral_outer}.\nInner sheet: {inner_thickness_mm} mm, {inner_coating}.\nCore: {core_type}.',
  de:'Montage von ca. {qty_m2} mÂ² Sandwich-Fassadenpaneelen.\n{orientation} montiert.\nDicke: {thickness_mm} mm. Wirkbreite: {working_width_mm} mm.\nAuÃŸenblech: {outer_thickness_mm} mm, {outer_coating} RAL {ral_outer}.\nInnenblech: {inner_thickness_mm} mm, {inner_coating}.\nKern: {core_type}.',
  sk:'MontÃ¡Å¾ cca {qty_m2} mÂ² izolovanÃ½ch fasÃ¡dnych panelov.\nMontovanÃ© {orientation}.\nHrÃºbka: {thickness_mm} mm. PracovnÃ¡ Å¡Ã­rka: {working_width_mm} mm.\nVonkajÅ¡Ã­ plech: {outer_thickness_mm} mm, {outer_coating} RAL {ral_outer}.\nVnÃºtornÃ½ plech: {inner_thickness_mm} mm, {inner_coating}.\nJadro: {core_type}.',
  fa:'Ù†ØµØ¨ Ø­Ø¯ÙˆØ¯ {qty_m2} Ù…ØªØ± Ù…Ø±Ø¨Ø¹ Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒ Ø¹Ø§ÛŒÙ‚.\nÙ†ØµØ¨ {orientation}.\nØ¶Ø®Ø§Ù…Øª: {thickness_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±. Ø¹Ø±Ø¶ Ù…ÙÛŒØ¯: {working_width_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±.\nÙˆØ±Ù‚ Ø¨ÛŒØ±ÙˆÙ†ÛŒ: {outer_thickness_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±ØŒ {outer_coating} RAL {ral_outer}.\nÙˆØ±Ù‚ Ø¯Ø§Ø®Ù„ÛŒ: {inner_thickness_mm} Ù…ÛŒÙ„ÛŒÙ…ØªØ±ØŒ {inner_coating}.\nÙ‡Ø³ØªÙ‡: {core_type}.'
 },
 vars:[
  {n:'qty_m2',l:{nl:'Geveloppervlak',en:'Wall area',de:'WandflÃ¤che',sk:'Plocha fasÃ¡dy',fa:'Ù…Ø³Ø§Ø­Øª Ù†Ù…Ø§'},u:'mÂ²',t:'number',ph:'1001'},
  {n:'orientation',l:{nl:'OriÃ«ntatie',en:'Orientation',de:'Ausrichtung',sk:'OrientÃ¡cia',fa:'Ø¬Ù‡Øª Ù†ØµØ¨'},u:'',t:'select',opts:['Verticaal','Horizontaal']},
  {n:'thickness_mm',l:{nl:'Paneeldikte',en:'Panel thickness',de:'Paneeldicke',sk:'HrÃºbka panela',fa:'Ø¶Ø®Ø§Ù…Øª Ù¾Ù†Ù„'},u:'mm',t:'number',ph:'100'},
  {n:'working_width_mm',l:{nl:'Werkende breedte',en:'Working width',de:'Wirkbreite',sk:'PracovnÃ¡ Å¡Ã­rka',fa:'Ø¹Ø±Ø¶ Ù…ÙÛŒØ¯'},u:'mm',t:'number',ph:'1000'},
  {n:'outer_thickness_mm',l:{nl:'Buitenplaat',en:'Outer steel',de:'AuÃŸenblech',sk:'VonkajÅ¡Ã­ plech',fa:'ÙˆØ±Ù‚ Ø¨ÛŒØ±ÙˆÙ†ÛŒ'},u:'mm',t:'number',ph:'0.60'},
  {n:'outer_coating',l:{nl:'Coating buiten',en:'Outer coating',de:'AuÃŸenbeschichtung',sk:'VonkajÅ¡Ã­ nÃ¡ter',fa:'Ù¾ÙˆØ´Ø´ Ø¨ÛŒØ±ÙˆÙ†ÛŒ'},u:'',t:'select',opts:['HDX','Polyester','Diamond']},
  {n:'ral_outer',l:{nl:'RAL buiten',en:'RAL outer',de:'RAL auÃŸen',sk:'RAL vonkajÅ¡Ã­',fa:'RAL Ø¨ÛŒØ±ÙˆÙ†ÛŒ'},u:'',t:'text',ph:'9016'},
  {n:'inner_thickness_mm',l:{nl:'Binnenplaat',en:'Inner steel',de:'Innenblech',sk:'VnÃºtornÃ½ plech',fa:'ÙˆØ±Ù‚ Ø¯Ø§Ø®Ù„ÛŒ'},u:'mm',t:'number',ph:'0.50'},
  {n:'inner_coating',l:{nl:'Coating binnen',en:'Inner coating',de:'Innenbeschichtung',sk:'VnÃºtornÃ½ nÃ¡ter',fa:'Ù¾ÙˆØ´Ø´ Ø¯Ø§Ø®Ù„ÛŒ'},u:'',t:'text',ph:'interieurcoating 15 mu RAL 9002'},
  {n:'core_type',l:{nl:'Kernmateriaal',en:'Core material',de:'Kernmaterial',sk:'MateriÃ¡l jadra',fa:'Ù…ÙˆØ§Ø¯ Ù‡Ø³ØªÙ‡'},u:'',t:'select',opts:['PIR','PUR','Mineral Wool']},
]},
// --- CH5: Site provisions ---
{id:'TB-EQ-01',ch:'CH5',mand:true,sl:'supply_install',
 ti:{nl:'Materieel',en:'Equipment',de:'GerÃ¤te',sk:'Zariadenie',fa:'ØªØ¬Ù‡ÛŒØ²Ø§Øª'},
 ds:{nl:'Kraan, hoogwerker, materiaal',en:'Crane, platform, materials',de:'Kran, HebebÃ¼hne, Material',sk:'Å½eriav, ploÅ¡ina, materiÃ¡l',fa:'Ø¬Ø±Ø«Ù‚ÛŒÙ„ØŒ Ø¨Ø§Ù„Ø§Ø¨Ø±ØŒ Ù…ØµØ§Ù„Ø­'},
 tp:{
  nl:'Inclusief kraan ({crane_type}) voor montage en lossen, incl. zuignap/hijstangen.\nInclusief klimmateriaal ({platform_type}).\nInclusief bevestigingsmateriaal en zaagwerk.',
  en:'Including crane ({crane_type}) for installation and unloading, incl. suction cups/lifting beams.\nIncluding access equipment ({platform_type}).\nIncluding fasteners and sawing work.',
  de:'Inklusive Kran ({crane_type}) fÃ¼r Montage und Entladung, inkl. SaugnÃ¤pfe/Hebegeschirr.\nInklusive Zugangstechnik ({platform_type}).\nInklusive Befestigungsmaterial und SÃ¤gearbeiten.',
  sk:'VrÃ¡tane Å¾eriavu ({crane_type}) na montÃ¡Å¾ a vykladanie.\nVrÃ¡tane prÃ­stupovej techniky ({platform_type}).\nVrÃ¡tane spojovacieho materiÃ¡lu a reznÃ½ch prÃ¡c.',
  fa:'Ø´Ø§Ù…Ù„ Ø¬Ø±Ø«Ù‚ÛŒÙ„ ({crane_type}) Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ùˆ ØªØ®Ù„ÛŒÙ‡.\nØ´Ø§Ù…Ù„ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø¯Ø³ØªØ±Ø³ÛŒ ({platform_type}).\nØ´Ø§Ù…Ù„ Ù…ØµØ§Ù„Ø­ Ø§ØªØµØ§Ù„ Ùˆ Ø¨Ø±Ø´Ú©Ø§Ø±ÛŒ.'
 },
 vars:[
  {n:'crane_type',l:{nl:'Kraantype',en:'Crane type',de:'Krantyp',sk:'Typ Å¾eriavu',fa:'Ù†ÙˆØ¹ Ø¬Ø±Ø«Ù‚ÛŒÙ„'},u:'',t:'text',ph:'33m torenkraan'},
  {n:'platform_type',l:{nl:'Hoogwerker',en:'Access platform',de:'HebebÃ¼hne',sk:'PloÅ¡ina',fa:'Ø¨Ø§Ù„Ø§Ø¨Ø±'},u:'',t:'text',ph:'telescoophoogwerker 12m'},
]},
// --- CH6: Conditions ---
{id:'TB-COND-01',ch:'CH6',mand:true,sl:'n/a',
 ti:{nl:'Uitgangspunten',en:'Site Conditions',de:'Rahmenbedingungen',sk:'Podmienky staveniska',fa:'Ø´Ø±Ø§ÛŒØ· Ú©Ø§Ø±Ú¯Ø§Ù‡'},
 ds:{nl:'Standaard uitgangspunten',en:'Standard assumptions',de:'Standardannahmen',sk:'Å tandardnÃ© predpoklady',fa:'ÙØ±Ø¶ÛŒØ§Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯'},
 tp:{
  nl:'Uitgangspunten:\n- Montage in {work_phases} aaneengesloten periode(n). Onderbrekingen worden doorberekend.\n- Montage op vlakke (staal)constructie. Niet door ons op afwijkingen gecontroleerd.\n- Terrein rondom voldoende breed, verhard en vrij van obstakels.\n- Rijplaten door en voor rekening van opdrachtgever.\n- Stroom gratis binnen 30 meter.\n- Schaftkeet en sanitair door opdrachtgever.\n- Tussentijds niet afgedekt (weerrisico opdrachtgever).\n- CAR verzekering afgesloten door opdrachtgever.',
  en:'Site conditions:\n- Work in {work_phases} continuous period(s). Interruptions charged separately.\n- Installation on flat steel structure. Not checked for deviations.\n- Sufficient hardened access around site, obstacle-free.\n- Trackway mats at client expense.\n- Free power supply within 30m radius.\n- Welfare facilities provided by client.\n- No interim covering (weather risk with client).\n- CAR insurance arranged by client.',
  de:'Rahmenbedingungen:\n- AusfÃ¼hrung in {work_phases} zusammenhÃ¤ngenden Periode(n). Unterbrechungen werden berechnet.\n- Montage auf ebener Stahlkonstruktion. Nicht auf Abweichungen geprÃ¼ft.\n- Ausreichend befestigter Zugang, hindernisfrei.\n- Fahrplatten auf Kosten des Auftraggebers.\n- Strom kostenlos im Umkreis von 30m.\n- Baustelleneinrichtung durch Auftraggeber.\n- Keine Zwischenabdeckung (Witterungsrisiko Auftraggeber).\n- CAR-Versicherung durch Auftraggeber.',
  sk:'Podmienky:\n- PrÃ¡ce v {work_phases} sÃºvislom obdobÃ­. PreruÅ¡enia sa ÃºÄtujÃº osobitne.\n- MontÃ¡Å¾ na rovnÃº oceÄ¾ovÃº konÅ¡trukciu.\n- DostatoÄnÃ½ spevnenÃ½ prÃ­stup.\n- JazdnÃ© dosky na nÃ¡klady objednÃ¡vateÄ¾a.\n- Elektrina zadarmo do 30m.\n- SociÃ¡lne zariadenia zabezpeÄÃ­ objednÃ¡vateÄ¾.\n- Bez prechodnÃ©ho zakrÃ½vania.\n- CAR poistenie zabezpeÄÃ­ objednÃ¡vateÄ¾.',
  fa:'Ø´Ø±Ø§ÛŒØ·:\n- Ø§Ø¬Ø±Ø§ Ø¯Ø± {work_phases} Ø¯ÙˆØ±Ù‡ Ù¾ÛŒÙˆØ³ØªÙ‡. ÙˆÙ‚ÙÙ‡â€ŒÙ‡Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n- Ù†ØµØ¨ Ø¨Ø± Ø±ÙˆÛŒ Ø³Ø§Ø²Ù‡ ÙÙˆÙ„Ø§Ø¯ÛŒ Ù…Ø³Ø·Ø­.\n- Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§ÙÛŒ Ùˆ Ø¨Ø¯ÙˆÙ† Ù…Ø§Ù†Ø¹.\n- ØµÙØ­Ø§Øª Ù…Ø³ÛŒØ± Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ø§Ø±ÙØ±Ù…Ø§.\n- Ø¨Ø±Ù‚ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¯Ø± Ø´Ø¹Ø§Ø¹ Û³Û° Ù…ØªØ±.\n- ØªØ³Ù‡ÛŒÙ„Ø§Øª Ø±ÙØ§Ù‡ÛŒ ØªÙˆØ³Ø· Ú©Ø§Ø±ÙØ±Ù…Ø§.\n- Ø¨Ø¯ÙˆÙ† Ù¾ÙˆØ´Ø´ Ù…ÙˆÙ‚Øª.\n- Ø¨ÛŒÙ…Ù‡ CAR ØªÙˆØ³Ø· Ú©Ø§Ø±ÙØ±Ù…Ø§.'
 },
 vars:[{n:'work_phases',l:{nl:'Werkfasen',en:'Work phases',de:'Arbeitsphasen',sk:'FÃ¡zy prÃ¡c',fa:'Ù…Ø±Ø§Ø­Ù„ Ú©Ø§Ø±'},u:'',t:'select',opts:['Ã©Ã©n','meerdere']}]},
// --- CH8: Commercial ---
{id:'TB-COMM-01',ch:'CH8',mand:true,sl:'n/a',
 ti:{nl:'Prijs- en leveringscondities',en:'Commercial Terms',de:'KaufmÃ¤nnische Bedingungen',sk:'ObchodnÃ© podmienky',fa:'Ø´Ø±Ø§ÛŒØ· Ø¨Ø§Ø²Ø±Ú¯Ø§Ù†ÛŒ'},
 ds:{nl:'Betalingsvoorwaarden, geldigheid',en:'Payment, validity',de:'Zahlung, GÃ¼ltigkeit',sk:'Platba, platnosÅ¥',fa:'Ù¾Ø±Ø¯Ø§Ø®ØªØŒ Ø§Ø¹ØªØ¨Ø§Ø±'},
 tp:{
  nl:'Prijs- en leveringscondities:\n- Prijzen {validity_days} dagen geldig.\n- Ongedeelde opdracht.\n- Exclusief BTW.\n- Levertijd: ca. {lead_time} weken na opdracht.\n- Materiaalprijsstijgingen worden doorberekend.\n\nBetalingstermijnen:\n- {term_1_pct}% bij opdracht\n- Na rato van werkzaamheden\n- {term_final_pct}% bij oplevering\n\nNetto binnen 14 dagen na factuurdatum.',
  en:'Commercial terms:\n- Prices valid {validity_days} days.\n- Undivided order.\n- Excluding VAT.\n- Lead time: approx. {lead_time} weeks after order.\n- Material price increases passed on.\n\nPayment terms:\n- {term_1_pct}% upon order\n- Pro rata on progress\n- {term_final_pct}% upon completion\n\nNet within 14 days of invoice date.',
  de:'KaufmÃ¤nnische Bedingungen:\n- Preise {validity_days} Tage gÃ¼ltig.\n- Ungeteilter Auftrag.\n- Ohne MwSt.\n- Lieferzeit: ca. {lead_time} Wochen nach Auftrag.\n- MaterialpreiserhÃ¶hungen werden weitergegeben.\n\nZahlungsbedingungen:\n- {term_1_pct}% bei Auftragserteilung\n- Anteilig nach Fortschritt\n- {term_final_pct}% bei Fertigstellung\n\nNetto innerhalb 14 Tagen.',
  sk:'ObchodnÃ© podmienky:\n- Ceny platnÃ© {validity_days} dnÃ­.\n- NedeliteÄ¾nÃ¡ objednÃ¡vka.\n- Bez DPH.\n- Dodacia lehota: cca {lead_time} tÃ½Å¾dÅˆov.\n\nPlatobnÃ© podmienky:\n- {term_1_pct}% pri objednÃ¡vke\n- Pomerne podÄ¾a postupu\n- {term_final_pct}% pri dokonÄenÃ­\n\nSplatnosÅ¥ 14 dnÃ­.',
  fa:'Ø´Ø±Ø§ÛŒØ· Ø¨Ø§Ø²Ø±Ú¯Ø§Ù†ÛŒ:\n- Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ {validity_days} Ø±ÙˆØ² Ù…Ø¹ØªØ¨Ø±.\n- Ø³ÙØ§Ø±Ø´ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡.\n- Ø¨Ø¯ÙˆÙ† Ù…Ø§Ù„ÛŒØ§Øª.\n- Ø²Ù…Ø§Ù† ØªØ­ÙˆÛŒÙ„: Ø­Ø¯ÙˆØ¯ {lead_time} Ù‡ÙØªÙ‡.\n\nØ´Ø±Ø§ÛŒØ· Ù¾Ø±Ø¯Ø§Ø®Øª:\n- {term_1_pct}% Ù‡Ù†Ú¯Ø§Ù… Ø³ÙØ§Ø±Ø´\n- Ø¨Ù‡ Ù†Ø³Ø¨Øª Ù¾ÛŒØ´Ø±ÙØª\n- {term_final_pct}% Ù‡Ù†Ú¯Ø§Ù… ØªÚ©Ù…ÛŒÙ„\n\nØ¸Ø±Ù Û±Û´ Ø±ÙˆØ² Ù¾Ø³ Ø§Ø² ØµØ¯ÙˆØ± ØµÙˆØ±ØªØ­Ø³Ø§Ø¨.'
 },
 vars:[
  {n:'validity_days',l:{nl:'Geldigheid',en:'Validity',de:'GÃ¼ltigkeit',sk:'PlatnosÅ¥',fa:'Ø§Ø¹ØªØ¨Ø§Ø±'},u:{nl:'dagen',en:'days',de:'Tage',sk:'dnÃ­',fa:'Ø±ÙˆØ²'},t:'number',ph:'14'},
  {n:'lead_time',l:{nl:'Levertijd',en:'Lead time',de:'Lieferzeit',sk:'Dodacia lehota',fa:'Ø²Ù…Ø§Ù† ØªØ­ÙˆÛŒÙ„'},u:{nl:'weken',en:'weeks',de:'Wochen',sk:'tÃ½Å¾dÅˆov',fa:'Ù‡ÙØªÙ‡'},t:'text',ph:'6-8'},
  {n:'term_1_pct',l:{nl:'Eerste termijn',en:'First payment',de:'Erste Rate',sk:'PrvÃ¡ splÃ¡tka',fa:'Ù¾Ø±Ø¯Ø§Ø®Øª Ø§ÙˆÙ„'},u:'%',t:'number',ph:'10'},
  {n:'term_final_pct',l:{nl:'Laatste termijn',en:'Final payment',de:'Letzte Rate',sk:'PoslednÃ¡ splÃ¡tka',fa:'Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‡Ø§ÛŒÛŒ'},u:'%',t:'number',ph:'10'},
]},
// --- CH9: Exclusions ---
{id:'TB-EXCL-01',ch:'CH9',mand:true,sl:'n/a',
 ti:{nl:'Uitsluitingen',en:'Exclusions',de:'AusschlÃ¼sse',sk:'VylÃºÄenia',fa:'Ù…ÙˆØ§Ø±Ø¯ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡'},
 ds:{nl:'Niet inbegrepen',en:'Excluded items',de:'Nicht enthalten',sk:'Nie je zahrnutÃ©',fa:'Ù…ÙˆØ§Ø±Ø¯ Ø´Ø§Ù…Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯'},
 tp:{
  nl:'Niet in onze prijs opgenomen:\n- Cannelurevulling kopse kanten dakplaten\n- Afdichtingsband tussen panelen en constructie\n- Schoonmaken vervuiling door slechte omstandigheden\n- Afvoeren verpakkings-/afvalmateriaal (opdrachtgever zorgt voor container)\n- Leveren PVC noodoversstort\n- Constructieve berekeningen en tekenwerk\n- Demontage/sloopwerk\n- Sparingen >250mm dienen volledig ondersteund (raveling)',
  en:'Not included in our price:\n- Cannelure filling at ridge ends\n- Sealing tape between panels and substructure\n- Cleaning due to poor site conditions\n- Waste removal (client provides container)\n- PVC emergency overflow supply\n- Structural calculations and drawings\n- Demolition/dismantling\n- Openings >250mm must be fully trimmed',
  de:'Nicht im Preis enthalten:\n- SickenausfÃ¼llung an Stirnseiten\n- Dichtungsband zwischen Paneelen und Konstruktion\n- Reinigung bei schlechten Baustellenbedingungen\n- Abfallentsorgung (Auftraggeber stellt Container)\n- PVC-NotÃ¼berlauf\n- Statik und Zeichenarbeit\n- Demontage-/Abrissarbeiten\n- Ã–ffnungen >250mm mÃ¼ssen allseitig unterstÃ¼tzt sein',
  sk:'Nie je zahrnutÃ© v cene:\n- VÃ½plÅˆ drÃ¡Å¾ok na ÄelnÃ½ch stranÃ¡ch\n- Tesniaca pÃ¡ska medzi panelmi a konÅ¡trukciou\n- ÄŒistenie pri zlÃ½ch podmienkach\n- Odvoz odpadu (kontajner zabezpeÄÃ­ objednÃ¡vateÄ¾)\n- PVC nÃºdzovÃ½ prepad\n- StatickÃ© vÃ½poÄty a vÃ½kresy\n- DemontÃ¡Å¾/bÃºracie prÃ¡ce\n- Otvory >250mm musia byÅ¥ plne podopretÃ©',
  fa:'Ù…ÙˆØ§Ø±Ø¯ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù‚ÛŒÙ…Øª:\n- Ù¾Ø±Ú©Ø±Ø¯Ù† Ø´ÛŒØ§Ø±Ù‡Ø§ Ø¯Ø± Ù„Ø¨Ù‡â€ŒÙ‡Ø§\n- Ù†ÙˆØ§Ø± Ø¢Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø¨ÛŒÙ† Ù¾Ù†Ù„â€ŒÙ‡Ø§ Ùˆ Ø³Ø§Ø²Ù‡\n- ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ Ù†Ø§Ø´ÛŒ Ø§Ø² Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ù†Ø§Ø³Ø¨\n- Ø­Ù…Ù„ Ø²Ø¨Ø§Ù„Ù‡ (Ú©Ø§Ø±ÙØ±Ù…Ø§ Ú©Ø§Ù†ØªÛŒÙ†Ø± ØªØ§Ù…ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯)\n- ØªØ§Ù…ÛŒÙ† Ø³Ø±Ø±ÛŒØ² Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ PVC\n- Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ø§Ø²Ù‡â€ŒØ§ÛŒ Ùˆ Ù†Ù‚Ø´Ù‡â€ŒÚ©Ø´ÛŒ\n- ØªØ®Ø±ÛŒØ¨/Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ\n- Ø¨Ø§Ø²Ø´ÙˆÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² Û²ÛµÛ° Ù…ÛŒÙ„ÛŒÙ…ØªØ± Ø¨Ø§ÛŒØ¯ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ù‡Ø§Ø± Ø´ÙˆÙ†Ø¯'
 },
 vars:[]},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = { sel:new Set(), vals:{}, supVars:{}, delBlocks:new Set(), lang:'nl' };
const t = k => UI[S.lang]?.[k] || UI.en?.[k] || k;
const L = o => typeof o==='string' ? o : (o?.[S.lang] || o?.en || o?.nl || '');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LANGUAGE SWITCHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildLangBar() {
  const bar = document.getElementById('lang-bar');
  bar.innerHTML = LANGS.map(l =>
    `<button class="${l.code===S.lang?'on':''}" data-l="${l.code}" onclick="setLang('${l.code}')"><span class="fl">${l.flag}</span> ${l.label}</button>`
  ).join('');
}
function setLang(code) {
  S.lang = code;
  document.documentElement.lang = code;
  document.documentElement.dir = code==='fa' ? 'rtl' : 'ltr';
  buildLangBar(); applyUI(); renderChapters(); renderVF(); upd(); updS();
}
function applyUI() {
  document.getElementById('ui-sub').textContent = t('sub');
  document.getElementById('btn-r').innerHTML = t('btnR');
  document.getElementById('btn-e').innerHTML = t('btnE');
  document.getElementById('ui-pt').textContent = t('pt');
  document.getElementById('lbl-pn').textContent = t('pn');
  document.getElementById('lbl-pc').textContent = t('pc');
  document.getElementById('lbl-scope').textContent = t('scope');
  document.getElementById('lbl-rfq').textContent = t('rfq');
  document.getElementById('lbl-pd').textContent = t('pd');
  document.getElementById('ui-st').textContent = t('st');
  document.getElementById('ui-sh').textContent = t('sh');
  document.getElementById('ui-et').textContent = t('et');
  document.getElementById('ui-eh').textContent = t('eh');
  document.getElementById('ui-pvt').textContent = t('pvt');
  document.getElementById('ui-sr').textContent = t('sr');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHAPTER & BLOCK LIST (left sidebar)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderChapters() {
  let h = '';
  CHAPTERS.forEach(ch => {
    const blocks = TB.filter(b => b.ch === ch.id);
    const selCount = blocks.filter(b => S.sel.has(b.id)).length;
    const isOpen = blocks.length > 0; // auto-open chapters with blocks

    h += `<div class="ch-group${isOpen?' open':''}" id="chg-${ch.id}">`;
    h += `<div class="ch-head" onclick="toggleCh('${ch.id}')">`;
    h += `<span class="ch-num">${ch.num}.</span>`;
    h += `<span class="ch-title">${L(ch.ti)}</span>`;
    if (blocks.length) h += `<span class="ch-count">${selCount}/${blocks.length}</span>`;
    h += `<span class="ch-arrow">â–¶</span>`;
    h += `</div>`;

    if (blocks.length) {
      h += `<div class="ch-blocks">`;
      blocks.forEach(b => {
        const sel = S.sel.has(b.id);
        h += `<div class="blk${sel?' sel':''}" onclick="togBlock('${b.id}')">`;
        h += `<div class="blk-ck">${sel?'âœ“':''}</div>`;
        h += `<div class="blk-info"><h4>${L(b.ti)}</h4><p>${L(b.ds)}</p></div>`;
        h += `<div class="blk-badge ${b.mand?'req':'opt'}">${b.mand?t('req'):t('opt')}</div>`;
        h += `</div>`;
      });
      h += `</div>`;
    }
    h += `</div>`;
  });
  document.getElementById('ch-list').innerHTML = h;
}
function toggleCh(chId) {
  document.getElementById('chg-'+chId).classList.toggle('open');
}
function togBlock(id) {
  if(S.sel.has(id)) S.sel.delete(id); else S.sel.add(id);
  renderChapters(); renderVF(); upd(); updS();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VARIABLE FORMS (middle panel)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderVF() {
  const c = document.getElementById('var-forms');
  const es = document.getElementById('empty-s');
  const sel = TB.filter(b => S.sel.has(b.id));
  if (!sel.length) { es.style.display='flex'; c.innerHTML=''; return; }
  es.style.display='none';

  let h = '';
  // Group by chapter
  CHAPTERS.forEach(ch => {
    const chBlocks = sel.filter(b => b.ch === ch.id);
    if (!chBlocks.length) return;

    chBlocks.forEach(b => {
      const isDel = S.delBlocks.has(b.id);
      const sl = b.sl;
      const slab = sl==='install_only'?t('io') : sl==='supply_install'?t('si') : sl==='varies'?t('sv') : '';
      const swarn = sl==='varies' ? ' warn' : '';

      h += `<div class="var-sect">`;
      h += `<div class="var-head">`;
      h += `<h3>${ch.num}. ${L(b.ti)}</h3>`;
      h += `<div class="var-head-right">`;
      if (slab) h += `<span class="scope-tag${swarn}">${slab}</span>`;
      if (b.vars.length) {
        h += `<div class="del-block${isDel?' on':''}" onclick="toggleDelBlock('${b.id}')" title="${t('delAll')}">`;
        h += `<span class="ck">${isDel?'âœ“':''}</span> ${t('delAll')}`;
        h += `</div>`;
      }
      h += `</div></div>`;

      if (b.vars.length) {
        h += `<div class="var-grid${isDel?' delegated':''}">`;
        b.vars.forEach(v => {
          const val = S.vals[b.id]?.[v.n] || '';
          const us = typeof v.u === 'object' ? L(v.u) : v.u;
          const ll = L(v.l);
          const isSup = !isDel && (S.supVars[b.id]?.[v.n] || false);
          const supCls = isSup ? 'sup-set' : '';
          const supAct = isSup ? 'on' : '';

          h += `<div class="vf ${supCls}">`;
          h += `<label><span class="sup-row"><span>${ll}${us?` <span class="u">(${us})</span>`:''}</span>`;
          if (!isDel) {
            h += `<span class="sup-btn ${supAct}" onclick="event.stopPropagation();toggleSup('${b.id}','${v.n}')"><span class="sc">${isSup?'âœ“':''}</span> ${t('supBtn')}</span>`;
          }
          h += `</span></label>`;

          if (v.t === 'select') {
            h += `<select onchange="sv('${b.id}','${v.n}',this.value)"${isSup||isDel?' disabled':''}><option value="">${t('sel')}</option>${v.opts.map(o=>`<option value="${o}"${val===o?' selected':''}>${o}</option>`).join('')}</select>`;
          } else {
            h += `<input type="text" value="${isSup?'':val}" placeholder="${isSup?t('supFull'):(v.ph||'')}" oninput="sv('${b.id}','${v.n}',this.value)"${isSup||isDel?' disabled':''}>`;
          }
          h += `</div>`;
        });
        h += `</div>`;
      } else {
        h += `<p style="font-size:12px;color:#999;font-style:italic">${L(b.tp).substring(0,120)}...</p>`;
      }
      h += `</div>`;
    });
  });
  c.innerHTML = h;
}
function toggleDelBlock(bid) {
  if (S.delBlocks.has(bid)) S.delBlocks.delete(bid); else S.delBlocks.add(bid);
  renderVF(); upd(); updS();
}
function toggleSup(bid, vn) {
  if (!S.supVars[bid]) S.supVars[bid] = {};
  S.supVars[bid][vn] = !S.supVars[bid][vn];
  if (S.supVars[bid][vn]) S.vals[bid][vn] = '';
  renderVF(); upd(); updS();
}
function sv(bid, vn, val) {
  if (!S.vals[bid]) S.vals[bid] = {};
  S.vals[bid][vn] = val;
  upd(); updS();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PREVIEW (right panel)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function upd() {
  const c = document.getElementById('pv-body');
  const pc = document.getElementById('pv-cnt');
  const sel = TB.filter(b => S.sel.has(b.id));
  pc.textContent = sel.length + ' ' + t('bk');

  if (!sel.length) {
    c.innerHTML = `<p style="color:#555;font-size:12px;text-align:center;margin-top:30px">${t('eh')}</p>`;
    return;
  }

  let h = '';
  CHAPTERS.forEach(ch => {
    const chBlocks = sel.filter(b => b.ch === ch.id);
    if (!chBlocks.length) return;

    h += `<div class="pv-ch">`;
    h += `<div class="pv-ch-head">${ch.num}. ${L(ch.ti)}</div>`;

    chBlocks.forEach(b => {
      h += `<div class="pv-blk">`;
      h += `<div class="pv-blk-title">${L(b.ti)}</div>`;

      if (S.delBlocks.has(b.id)) {
        h += `<div class="pv-blk-del">[${t('delAll')}]</div>`;
      } else {
        let tx = L(b.tp);
        const vs = S.vals[b.id] || {};
        tx = tx.replace(/\{(\w+)\}/g, (m, vn) => {
          if (S.supVars[b.id]?.[vn]) return `<span class="vs">[${t('supFull')}]</span>`;
          const val = vs[vn];
          if (val) return `<span class="vh">${val}</span>`;
          const vd = b.vars.find(v => v.n === vn);
          return `<span class="ve">[${vd ? L(vd.l) : vn}]</span>`;
        });
        h += `<div class="pv-blk-txt">${tx}</div>`;
      }
      h += `</div>`;
    });
    h += `</div>`;
  });
  c.innerHTML = h;
}
function updS() {
  document.getElementById('st-b').textContent = S.sel.size + ' ' + t('bsel');
  let f=0, tt=0, sp=0, dl=0;
  TB.filter(b => S.sel.has(b.id)).forEach(b => {
    if (S.delBlocks.has(b.id)) { dl++; return; }
    b.vars.forEach(v => { tt++; if(S.supVars[b.id]?.[v.n]) sp++; else if(S.vals[b.id]?.[v.n]) f++; });
  });
  let txt = `${f}/${tt} ${t('vfil')}`;
  if (sp) txt += ` Â· ${sp}Ã— ${t('supBtn')}`;
  if (dl) txt += ` Â· ${dl}Ã— ${t('delAll')}`;
  document.getElementById('st-v').textContent = txt;
}
function resetAll() {
  S.sel.clear(); S.delBlocks.clear();
  TB.forEach(b => { if(b.mand) S.sel.add(b.id); S.vals[b.id]={}; S.supVars[b.id]={}; });
  renderChapters(); renderVF(); upd(); updS();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESIZABLE COLUMNS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initResize() {
  const app = document.getElementById('app');
  const colL = document.getElementById('col-left');
  const colR = document.getElementById('col-right');
  const dragL = document.getElementById('drag-left');
  const dragR = document.getElementById('drag-right');

  let active = null, startX = 0, startW = 0;

  function onDown(e, side) {
    e.preventDefault();
    active = side;
    startX = e.clientX;
    startW = side === 'left' ? colL.offsetWidth : colR.offsetWidth;
    document.body.style.cursor = 'col-resize';
    document.body.style.userSelect = 'none';
    (side==='left'?dragL:dragR).classList.add('dragging');
  }
  dragL.addEventListener('mousedown', e => onDown(e, 'left'));
  dragR.addEventListener('mousedown', e => onDown(e, 'right'));

  document.addEventListener('mousemove', e => {
    if (!active) return;
    const dx = e.clientX - startX;
    if (active === 'left') {
      const w = Math.max(240, Math.min(500, startW + dx));
      colL.style.width = w + 'px';
    } else {
      const w = Math.max(260, Math.min(560, startW - dx));
      colR.style.width = w + 'px';
    }
  });
  document.addEventListener('mouseup', () => {
    if (active) {
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
      dragL.classList.remove('dragging');
      dragR.classList.remove('dragging');
      active = null;
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TEMPLATE LOADING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let templateData = null;
async function loadTemplate() {
  try {
    const resp = await fetch('template.docx');
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    templateData = await resp.arrayBuffer();
    console.log('Template loaded:', templateData.byteLength, 'bytes');
  } catch(err) {
    console.warn('Template load failed:', err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUTO-GENERATE RFQ NUMBER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genRfqNum() {
  const y = new Date().getFullYear();
  const seq = String(Math.floor(Math.random()*9000)+1000);
  document.getElementById('proj-rfq').value = `RFQ-${y}-${seq}`;
  upd();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WORD EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function escXml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// STM intro text for page 2
const STM_INTRO = {
  nl:'STM Group is gespecialiseerd in staalconstructies, gevelbekleding en montage voor de utiliteitsbouw. Met ruim 25 jaar ervaring leveren wij complete oplossingen van engineering tot en met oplevering.\n\nDit document betreft een aanvraag voor offerte (RFQ). Hierin vindt u:\n\u2022  Een omschrijving van de gevraagde werkzaamheden en leveringen\n\u2022  De technische specificaties en standaarden\n\u2022  De uitgangspunten en randvoorwaarden voor uitvoering\n\u2022  De commerciÃ«le voorwaarden\n\nWij verzoeken u uw aanbieding volledig en conform de gestelde eisen in te dienen. Afwijkingen, aannames en uitsluitingen dienen expliciet en schriftelijk te worden vermeld. Werkzaamheden die niet expliciet zijn uitgesloten, worden geacht te zijn inbegrepen.',
  en:'STM Group specialises in steel structures, cladding and erection for commercial construction. With over 25 years of experience, we deliver complete solutions from engineering through to handover.\n\nThis document is a Request for Quotation (RFQ). It contains:\n\u2022  A description of the requested works and deliveries\n\u2022  Technical specifications and standards\n\u2022  Site conditions and constraints\n\u2022  Commercial terms\n\nPlease submit your quotation fully compliant with the stated requirements. Deviations, assumptions and exclusions must be explicitly stated in writing. Works not explicitly excluded are deemed to be included.',
  de:'STM Group ist spezialisiert auf Stahlkonstruktionen, Fassadenverkleidung und Montage im Gewerbebau. Mit Ã¼ber 25 Jahren Erfahrung liefern wir KomplettlÃ¶sungen von der Planung bis zur Ãœbergabe.\n\nDieses Dokument ist eine Angebotsanfrage (RFQ). Es enthÃ¤lt:\n\u2022  Beschreibung der angeforderten Leistungen\n\u2022  Technische Spezifikationen und Standards\n\u2022  Rahmenbedingungen der Baustelle\n\u2022  KaufmÃ¤nnische Bedingungen\n\nBitte reichen Sie Ihr Angebot vollstÃ¤ndig und konform ein. Abweichungen und AusschlÃ¼sse sind schriftlich anzugeben.',
  sk:'STM Group sa Å¡pecializuje na oceÄ¾ovÃ© konÅ¡trukcie, oplÃ¡Å¡tenie a montÃ¡Å¾. S viac ako 25-roÄnÃ½mi skÃºsenosÅ¥ami dodÃ¡vame kompletnÃ© rieÅ¡enia.\n\nTento dokument je Å¾iadosÅ¥ o cenovÃº ponuku (RFQ). Obsahuje:\n\u2022  Opis poÅ¾adovanÃ½ch prÃ¡c\n\u2022  TechnickÃ© Å¡pecifikÃ¡cie\n\u2022  Podmienky staveniska\n\u2022  ObchodnÃ© podmienky',
  fa:'Ú¯Ø±ÙˆÙ‡ STM Ù…ØªØ®ØµØµ Ø¯Ø± Ø³Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙˆÙ„Ø§Ø¯ÛŒØŒ Ù†Ù…Ø§ÛŒ Ø³Ø§Ø®ØªÙ…Ø§Ù† Ùˆ Ù…ÙˆÙ†ØªØ§Ú˜ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ùˆ Ø³Ø§Ø² ØªØ¬Ø§Ø±ÛŒ Ø§Ø³Øª.\n\nØ§ÛŒÙ† Ø³Ù†Ø¯ ÛŒÚ© Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‚ÛŒÙ…Øª (RFQ) Ø§Ø³Øª. Ø´Ø§Ù…Ù„:\n\u2022  Ø´Ø±Ø­ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ\n\u2022  Ù…Ø´Ø®ØµØ§Øª ÙÙ†ÛŒ\n\u2022  Ø´Ø±Ø§ÛŒØ· Ú©Ø§Ø±Ú¯Ø§Ù‡\n\u2022  Ø´Ø±Ø§ÛŒØ· Ø¨Ø§Ø²Ø±Ú¯Ø§Ù†ÛŒ'
};

function buildIntroXml() {
  const intro = L(STM_INTRO);
  let xml = '';
  // Title line
  xml += '<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:color w:val="F94816"/><w:sz w:val="22"/><w:szCs w:val="22"/></w:rPr><w:t xml:space="preserve">' + escXml(L({nl:'Over dit document',en:'About this document',de:'Ãœber dieses Dokument',sk:'O tomto dokumente',fa:'Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ø³Ù†Ø¯'})) + '</w:t></w:r></w:p>';
  // Body lines
  intro.split('\n').forEach(line => {
    if (!line.trim()) {
      xml += '<w:p><w:pPr><w:spacing w:after="20"/></w:pPr></w:p>';
    } else {
      xml += '<w:p><w:pPr><w:spacing w:after="30"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:color w:val="FFFFFF"/><w:sz w:val="16"/><w:szCs w:val="16"/></w:rPr><w:t xml:space="preserve">' + escXml(line) + '</w:t></w:r></w:p>';
    }
  });
  return xml;
}

function buildBodyXml() {
  const sel = TB.filter(b => S.sel.has(b.id));
  if (!sel.length) return '';
  let xml = '';

  // Salutation + intro
  xml += '<w:p><w:pPr><w:spacing w:after="80"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="20"/><w:szCs w:val="20"/></w:rPr><w:t xml:space="preserve">' + escXml(t('dS')) + '</w:t></w:r></w:p>';
  xml += '<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="19"/><w:szCs w:val="19"/></w:rPr><w:t xml:space="preserve">' + escXml(t('dI')) + '</w:t></w:r></w:p>';
  xml += '<w:p><w:pPr><w:spacing w:after="100"/></w:pPr></w:p>';

  CHAPTERS.forEach(ch => {
    const chBlocks = sel.filter(b => b.ch === ch.id);
    if (!chBlocks.length) return;

    // Chapter heading â€” orange bold
    xml += '<w:p><w:pPr><w:spacing w:before="300" w:after="100"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:color w:val="F94816"/><w:sz w:val="26"/><w:szCs w:val="26"/></w:rPr><w:t xml:space="preserve">' + escXml(ch.num + '. ' + L(ch.ti)) + '</w:t></w:r></w:p>';

    chBlocks.forEach(b => {
      // Block title â€” bold dark
      xml += '<w:p><w:pPr><w:spacing w:before="140" w:after="40"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:color w:val="22293B"/><w:sz w:val="20"/><w:szCs w:val="20"/></w:rPr><w:t xml:space="preserve">' + escXml(L(b.ti)) + '</w:t></w:r></w:p>';

      if (S.delBlocks.has(b.id)) {
        xml += '<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:i/><w:color w:val="4A90D9"/><w:sz w:val="20"/></w:rPr><w:t xml:space="preserve">[' + escXml(t('delAll')) + ']</w:t></w:r></w:p>';
        return;
      }

      let txt = L(b.tp);
      const vs = S.vals[b.id] || {};
      const sup = S.supVars[b.id] || {};
      txt = txt.replace(/\{(\w+)\}/g, (m, vn) => {
        if (sup[vn]) return '[' + t('supFull') + ']';
        return vs[vn] || '[' + vn + ']';
      });

      txt.split('\n').forEach(line => {
        const ln = line.trim();
        if (!ln) { xml += '<w:p><w:pPr><w:spacing w:after="20"/></w:pPr></w:p>'; return; }
        const indent = (ln.startsWith('-') || ln.startsWith('\u2022')) ? '<w:ind w:left="360"/>' : '';
        xml += '<w:p><w:pPr><w:spacing w:after="30" w:line="276" w:lineRule="auto"/>' + indent + '</w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="19"/><w:szCs w:val="19"/></w:rPr><w:t xml:space="preserve">' + escXml(ln) + '</w:t></w:r></w:p>';
      });
    });
  });

  // Closing
  xml += '<w:p><w:pPr><w:spacing w:before="100" w:after="80"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="19"/><w:szCs w:val="19"/></w:rPr><w:t xml:space="preserve">' + escXml(t('dC')) + '</w:t></w:r></w:p>';
  xml += '<w:p><w:pPr><w:spacing w:after="60"/></w:pPr></w:p>';
  xml += '<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="20"/><w:szCs w:val="20"/></w:rPr><w:t xml:space="preserve">' + escXml(t('dG')) + '</w:t></w:r></w:p>';
  xml += '<w:p><w:pPr><w:spacing w:after="20"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:sz w:val="20"/><w:szCs w:val="20"/></w:rPr><w:t>STM Group</w:t></w:r></w:p>';

  return xml;
}

function buildTocXml() {
  const sel = TB.filter(b => S.sel.has(b.id));
  let items = [];
  CHAPTERS.forEach(ch => {
    if (sel.some(b => b.ch === ch.id)) {
      items.push(ch.num + '. ' + L(ch.ti));
    }
  });
  return items.map(item =>
    '<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="20"/><w:szCs w:val="20"/></w:rPr><w:t xml:space="preserve">' + escXml(item) + '</w:t></w:r></w:p>'
  ).join('');
}

async function exportToWord() {
  try {
    if (typeof JSZip === 'undefined') { alert('JSZip not loaded.'); return; }
    if (typeof saveAs === 'undefined') { alert('FileSaver not loaded.'); return; }
    if (!templateData) {
      await loadTemplate();
      if (!templateData) { alert('template.docx not found.'); return; }
    }

    const pn = document.getElementById('proj-name').value || '';
    const pc = document.getElementById('proj-code').value || '';
    const sc = document.getElementById('proj-scope').value || '';
    const rfq = document.getElementById('proj-rfq').value || '';
    const pd = document.getElementById('proj-date').value || '';
    const dl = S.lang==='de'?'de-DE' : S.lang==='en'?'en-GB' : S.lang==='sk'?'sk-SK' : 'nl-NL';
    const dateStr = pd ? new Date(pd).toLocaleDateString(dl, {day:'numeric', month:'long', year:'numeric'}) : '';

    // Load template
    const zip = new JSZip();
    await zip.loadAsync(templateData.slice(0));

    // === DOCUMENT.XML ===
    let docXml = await zip.file('word/document.xml').async('text');

    // Page 1: Cover â€” these are inside text boxes, but string replacement works on raw XML
    const allReplace = (xml, old, val) => { while(xml.indexOf(old)!==-1) xml=xml.replace(old,val); return xml; };
    
    docXml = allReplace(docXml, '{{Project name}}', escXml(pn));
    docXml = allReplace(docXml, '{{Prjocet code}}+{{scope}}', escXml(pc + ' \u2014 ' + sc));

    // Page 2: STM intro â€” replace placeholder with multi-paragraph XML
    // The placeholder is inside a txbxContent, so we replace the paragraph containing it
    const introPlaceholder = '{{Who we are and What the supplier will face in this documet}}';
    const introParaPattern = new RegExp(
      '<w:p[^>]*>(?:(?!<\\/w:p>).)*?' + introPlaceholder.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '(?:(?!<\\/w:p>).)*?<\\/w:p>',
      's'
    );
    const introXml = buildIntroXml();
    if (introParaPattern.test(docXml)) {
      docXml = docXml.replace(introParaPattern, introXml);
      // Handle duplicate (fallback textbox)
      if (introParaPattern.test(docXml)) {
        docXml = docXml.replace(introParaPattern, introXml);
      }
    } else {
      // Fallback: simple string replacement
      docXml = allReplace(docXml, introPlaceholder, '');
    }

    // Page 3: TOC â€” Date is wrapped in {{ }} as separate elements
    docXml = allReplace(docXml, '19 maart 2025', escXml(dateStr));
    // Clean up the {{ and }} that user added around date
    // They appear as separate <w:t>{{</w:t> and <w:t>}}</w:t>
    docXml = docXml.replace(/>(\{\{)<\/w:t>/g, '><\/w:t>');
    docXml = docXml.replace(/>(\}\})<\/w:t>/g, '><\/w:t>');

    // TOC: Replace SDT content
    const sdtContentMatch = docXml.match(/<w:sdtContent>([\s\S]*?)<\/w:sdtContent>/);
    if (sdtContentMatch) {
      const tocXml = buildTocXml();
      docXml = docXml.replace(sdtContentMatch[0], '<w:sdtContent>' + tocXml + '</w:sdtContent>');
    }

    // Body: Replace {{Text Blocks}} paragraph
    const tbPattern = /<w:p[^>]*>(?:(?!<\/w:p>).)*?\{\{Text Blocks\}\}(?:(?!<\/w:p>).)*?<\/w:p>/;
    const bodyXml = buildBodyXml();
    if (tbPattern.test(docXml)) {
      // Also grab the page break paragraph right after
      docXml = docXml.replace(tbPattern, bodyXml);
    }

    zip.file('word/document.xml', docXml);

    // === HEADER ===
    const hdrFile = zip.file('word/header1.xml');
    if (hdrFile) {
      let hdrXml = await hdrFile.async('text');
      // Build header content: "STP25-0847: RFQ-2025-0031    Datum: 15 feb 2025"
      // The header might be empty in user's template, so we inject a paragraph
      const hdrContent = '<w:p><w:pPr><w:tabs><w:tab w:val="right" w:pos="9072"/></w:tabs></w:pPr>'
        + '<w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="14"/><w:szCs w:val="14"/></w:rPr>'
        + '<w:t xml:space="preserve">' + escXml(pc + ': ' + rfq) + '</w:t></w:r>'
        + '<w:r><w:tab/></w:r>'
        + '<w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="14"/><w:szCs w:val="14"/><w:color w:val="F94816"/></w:rPr>'
        + '<w:t xml:space="preserve">Datum: ' + escXml(dateStr) + '</w:t></w:r></w:p>';
      
      // Replace existing paragraph(s) in header body
      const hdrBodyMatch = hdrXml.match(/<w:hdr[^>]*>([\s\S]*)<\/w:hdr>/);
      if (hdrBodyMatch) {
        hdrXml = hdrXml.replace(hdrBodyMatch[1], hdrContent);
      }
      zip.file('word/header1.xml', hdrXml);
    }

    const blob = await zip.generateAsync({
      type:'blob',
      mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    });

    const fn = 'RFQ_' + (pc||'DRAFT') + '_' + (rfq||'0000') + '_' + S.lang.toUpperCase() + '.docx';
    saveAs(blob, fn);

  } catch(err) {
    console.error('Export error:', err);
    alert('Export failed: ' + err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  document.getElementById('proj-date').value = new Date().toISOString().split('T')[0];
  genRfqNum(); // Auto-generate RFQ number
  TB.forEach(b => { if(b.mand) S.sel.add(b.id); S.vals[b.id]={}; S.supVars[b.id]={}; });
  buildLangBar(); applyUI(); renderChapters(); renderVF(); upd(); updS();
  initResize();
  loadTemplate();
}
init();
</script>
</body>
</html>
