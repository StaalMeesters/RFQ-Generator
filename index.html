<!DOCTYPE html>
<html lang="nl" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>STM Group ‚Äî RFQ Configurator</title>
<link rel="icon" href="favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--o:#F94816;--dk:#22293B;--dk2:#314056;--lt:#F6F7F9;--wh:#fff;--gr:#2ECC71;--grL:#E8F8F0;--bl:#4A90D9;--blL:#EBF3FC;--bor:#E2E5EA;--txt:#333;--txtL:#888;--red:#E74C3C;--hdr:50px;--tab:38px}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Outfit',sans-serif;background:var(--lt);color:var(--txt);font-size:13px;overflow:hidden;height:100vh}
input,select,textarea,button{font-family:inherit;font-size:13px}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}
.topbar{height:var(--hdr);background:var(--dk);display:flex;align-items:center;padding:0 16px;gap:12px}
.topbar .logo{color:var(--o);font-weight:700;font-size:15px}.topbar .logo span{color:#fff;font-weight:300;margin-left:3px;font-size:11px;opacity:.6}
.topbar .spacer{flex:1}
.lang-bar{display:flex;gap:2px}.lang-bar button{background:transparent;border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.5);padding:2px 7px;border-radius:3px;cursor:pointer;font-size:10px;transition:.15s}
.lang-bar button:hover{color:#fff;border-color:rgba(255,255,255,.3)}.lang-bar button.on{background:var(--o);border-color:var(--o);color:#fff}
.topbar .btn-exp{background:var(--o);color:#fff;border:none;padding:5px 14px;border-radius:4px;cursor:pointer;font-weight:600;font-size:11px}.topbar .btn-exp:hover{background:#e03d0e}
.tabbar{height:var(--tab);background:var(--dk2);display:flex;align-items:stretch;padding:0 16px;gap:2px}
.tabbar button{background:transparent;border:none;color:rgba(255,255,255,.45);padding:0 16px;cursor:pointer;font-size:11.5px;font-weight:500;border-bottom:2px solid transparent;transition:.12s}
.tabbar button:hover{color:rgba(255,255,255,.8)}.tabbar button.on{color:#fff;border-bottom-color:var(--o)}
.tab-page{display:none;height:calc(100vh - var(--hdr) - var(--tab))}.tab-page.active{display:flex}
.col-left{width:280px;min-width:220px;max-width:420px;background:var(--wh);border-right:1px solid var(--bor);display:flex;flex-direction:column;overflow:hidden}
.col-mid{flex:1;min-width:300px;overflow:hidden;display:flex;flex-direction:column}
.col-right{width:320px;min-width:240px;max-width:500px;background:var(--wh);border-left:1px solid var(--bor);display:flex;flex-direction:column;overflow:hidden}
.drag-h{width:5px;cursor:col-resize;background:transparent;flex-shrink:0;transition:background .1s}.drag-h:hover,.drag-h.dragging{background:var(--o)}
.scroll{flex:1;overflow-y:auto;padding:10px}
.sel-box{margin-bottom:10px}.sel-box label{display:block;font-weight:600;font-size:10px;text-transform:uppercase;letter-spacing:.4px;color:var(--dk2);margin-bottom:3px}
.s-wrap{position:relative}.s-wrap input{width:100%;padding:6px 8px 6px 26px;border:1px solid var(--bor);border-radius:4px;font-size:11.5px;outline:none;transition:.12s}
.s-wrap input:focus{border-color:var(--o);box-shadow:0 0 0 2px rgba(249,72,22,.1)}.s-wrap .ico{position:absolute;left:7px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--txtL);pointer-events:none}
.dd{position:absolute;top:100%;left:0;right:0;max-height:200px;overflow-y:auto;background:var(--wh);border:1px solid var(--bor);border-top:none;border-radius:0 0 5px 5px;box-shadow:0 6px 20px rgba(0,0,0,.1);z-index:50;display:none}.dd.show{display:block}
.dd .di{padding:5px 8px;cursor:pointer;font-size:11px;border-bottom:1px solid #f5f5f5;transition:.08s}.dd .di:hover{background:var(--lt)}.dd .di .m{font-weight:500;color:var(--dk)}.dd .di .s{font-size:9.5px;color:var(--txtL);margin-top:1px}
.dd .dc{padding:3px 8px;font-size:9px;font-weight:700;color:var(--o);text-transform:uppercase;background:#fafafa;border-bottom:1px solid #eee}
.stag{display:flex;align-items:center;gap:5px;padding:4px 7px;background:var(--grL);border:1px solid var(--gr);border-radius:4px;margin-top:4px;font-size:10.5px}.stag .nm{font-weight:500;flex:1}.stag .cl{cursor:pointer;color:var(--red);font-size:13px;line-height:1}
.meta-row{display:flex;gap:6px;margin-bottom:8px}.meta-row>div{flex:1}.meta-row label{display:block;font-size:9.5px;font-weight:600;color:var(--dk2);text-transform:uppercase;margin-bottom:2px}
.meta-row input{width:100%;padding:5px 6px;border:1px solid var(--bor);border-radius:3px;font-size:11px;outline:none}.meta-row input:focus{border-color:var(--o)}
.chg{margin-bottom:4px}.chh{display:flex;align-items:center;padding:6px 8px;background:#f7f8fa;border-radius:5px;cursor:pointer;user-select:none;gap:5px;transition:.08s}.chh:hover{background:#eef0f2}
.chh .ar{font-size:9px;color:var(--txtL);transition:transform .12s;width:12px;text-align:center}.chh.open .ar{transform:rotate(90deg)}
.chh .cn{background:var(--o);color:#fff;font-size:9px;font-weight:700;border-radius:2px;padding:1px 4px;min-width:18px;text-align:center}
.chh .ct{flex:1;font-weight:500;font-size:11.5px}.chh .cc{font-size:9.5px;color:var(--txtL)}
.chb{display:none;padding:2px 0 2px 12px}.chg.open .chb{display:block}
.bli{display:flex;align-items:center;padding:4px 6px;border-radius:3px;cursor:pointer;gap:5px;transition:.06s;margin:1px 0}.bli:hover{background:var(--lt)}
.bli .ck{width:14px;height:14px;border:1.5px solid var(--bor);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:9px;color:transparent;transition:.1s;flex-shrink:0}
.bli.on .ck{background:var(--o);border-color:var(--o);color:#fff}
.bli .bl{flex:1;font-size:11px;line-height:1.3}.bli.del .bl{color:var(--bl);font-style:italic}
.bli .bt{font-size:8px;padding:1px 3px;border-radius:2px;background:var(--blL);color:var(--bl)}
.mid-sect{padding:10px 12px;border-bottom:1px solid var(--bor);background:var(--wh)}.mid-sect h3{font-size:13px;font-weight:600;color:var(--dk)}
.bcard{background:var(--wh);border:1px solid var(--bor);border-radius:6px;margin:6px 8px;padding:10px 12px}.bcard:hover{border-color:#ccd}
.bcard h4{font-size:12px;font-weight:600;color:var(--dk);margin-bottom:2px;display:flex;align-items:center;gap:6px}.bcard h4 .cnum{font-size:9px;color:var(--o);font-weight:700}
.bcard .bctrl{display:flex;gap:5px;margin:6px 0}
.tbtn{padding:3px 8px;border-radius:3px;font-size:9.5px;font-weight:600;cursor:pointer;border:1px solid var(--bor);background:var(--wh);transition:.1s}.tbtn:hover{border-color:#aaa}.tbtn.on{background:var(--bl);border-color:var(--bl);color:#fff}
.vgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:6px}
.vf label{display:block;font-size:9.5px;font-weight:600;color:var(--dk2);margin-bottom:2px;text-transform:uppercase;letter-spacing:.2px}
.vf input,.vf select,.vf textarea{width:100%;padding:5px 7px;border:1px solid var(--bor);border-radius:3px;outline:none;transition:.12s;font-size:11.5px}
.vf input:focus,.vf select:focus,.vf textarea:focus{border-color:var(--o);box-shadow:0 0 0 2px rgba(249,72,22,.08)}
.vf textarea{min-height:50px;resize:vertical}.vf.af input,.vf.af select{border-color:var(--gr);background:var(--grL)}.vf.ss input,.vf.ss select{border-color:var(--bl);background:var(--blL);font-style:italic}
.vf .st{font-size:8.5px;color:var(--bl);cursor:pointer;margin-top:1px;display:inline-block}.vf .st:hover{text-decoration:underline}
.empty-mid{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--txtL);gap:8px}.empty-mid .ei{font-size:36px;opacity:.25}
.pv-head{padding:8px 12px;border-bottom:1px solid var(--bor);background:var(--wh);font-size:12px;font-weight:600;color:var(--dk)}
.pvb{padding:14px;font-size:11px;line-height:1.65;color:var(--dk)}
.pvb .pc{font-size:13px;font-weight:700;color:var(--o);margin:14px 0 5px;padding-bottom:3px;border-bottom:1.5px solid var(--o)}.pvb .pc:first-child{margin-top:0}
.pvb .pbt{font-weight:600;color:var(--dk);margin:8px 0 2px;font-size:11.5px}
.pvb .pl{margin:2px 0}.pvb .pb{margin:1px 0 1px 14px}
.pvb .pv{background:#FFF3EE;color:var(--o);padding:0 2px;border-radius:2px;font-weight:500;font-size:10.5px}
.pvb .pv.f{background:var(--grL);color:#1a8a4a}.pvb .pv.sp{background:var(--blL);color:var(--bl);font-style:italic}
.pvb .pdel{color:var(--bl);font-style:italic;padding:3px 6px;background:var(--blL);border-radius:3px;margin:3px 0;font-size:10.5px}
/* EDITOR */
.ed-layout{display:flex;height:100%;overflow:hidden}
.ed-left{width:280px;min-width:220px;background:var(--wh);border-right:1px solid var(--bor);display:flex;flex-direction:column;overflow:hidden}
.ed-main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.ed-top{padding:8px 12px;border-bottom:1px solid var(--bor);background:var(--wh);display:flex;align-items:center;gap:8px}
.ed-top h3{font-size:13px;font-weight:600;flex:1}
.ed-top button{padding:4px 10px;border-radius:4px;font-size:10px;font-weight:600;cursor:pointer;border:1px solid var(--bor);background:var(--wh)}.ed-top button:hover{border-color:var(--o);color:var(--o)}
.ed-top .btn-save{background:var(--o);color:#fff;border-color:var(--o)}.ed-top .btn-save:hover{background:#e03d0e}
.ed-chlist{flex:1;overflow-y:auto;padding:8px}
.ed-ch{margin-bottom:4px}.ed-ch-head{display:flex;align-items:center;padding:6px 8px;background:#f7f8fa;border-radius:5px;cursor:pointer;gap:5px}.ed-ch-head:hover{background:#eef}
.ed-ch-head .num{background:var(--o);color:#fff;font-size:9px;font-weight:700;border-radius:2px;padding:1px 4px}.ed-ch-head .ti{flex:1;font-weight:500;font-size:11.5px}.ed-ch-head .cnt{font-size:9px;color:var(--txtL)}
.ed-ch.open .ed-ch-blocks{display:block}.ed-ch-blocks{display:none;padding:2px 0 2px 10px}
.ed-bl{display:flex;align-items:center;padding:4px 6px;border-radius:3px;cursor:pointer;gap:4px;margin:1px 0;font-size:11px;transition:.06s}
.ed-bl:hover{background:var(--lt)}.ed-bl.active{background:var(--blL);font-weight:500}
.ed-bl .dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}.ed-bl .dot.on{background:var(--gr)}.ed-bl .dot.off{background:#ddd}
.ed-panel{flex:1;overflow-y:auto;padding:16px}
.ed-empty{display:flex;align-items:center;justify-content:center;height:100%;color:var(--txtL);font-size:13px}
.ed-card{max-width:800px}
.ed-card h2{font-size:16px;font-weight:600;color:var(--dk);margin-bottom:12px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.ed-card h2 .badge{font-size:9px;padding:2px 6px;border-radius:3px;font-weight:600}
.ed-textarea{min-height:200px;border:1px solid var(--bor);border-radius:6px;padding:12px;font-size:12.5px;line-height:1.8;outline:none;white-space:pre-wrap;word-wrap:break-word;background:var(--wh)}
.ed-textarea:focus{border-color:var(--o);box-shadow:0 0 0 2px rgba(249,72,22,.1)}
.ed-textarea .pill{display:inline-block;background:#FFF0EB;border:1px solid var(--o);color:var(--o);padding:1px 6px;border-radius:3px;font-family:monospace;font-size:11px;font-weight:600;user-select:none;cursor:default;vertical-align:baseline;margin:0 1px;line-height:1.6}
.ed-textarea .pill.auto{border-color:var(--gr);background:var(--grL);color:#1a8a4a}
.ed-vars{margin-top:12px;border:1px solid var(--bor);border-radius:6px;overflow:hidden}
.ed-vars-head{padding:6px 10px;background:#f7f8fa;font-size:10px;font-weight:700;text-transform:uppercase;color:var(--dk2);border-bottom:1px solid var(--bor)}
.ed-var-row{display:flex;align-items:center;padding:5px 10px;border-bottom:1px solid #f5f5f5;font-size:11px;gap:8px}.ed-var-row:last-child{border-bottom:none}
.ed-var-row .vname{font-weight:600;color:var(--o);min-width:140px;font-family:monospace;font-size:10.5px}
.ed-var-row .vtype{font-size:9px;padding:1px 5px;border-radius:2px;background:var(--lt);color:var(--txtL);min-width:50px;text-align:center}
.ed-var-row .vlabel{flex:1;color:var(--dk)}.ed-var-row .vsrc{font-size:9px;color:var(--txtL)}
.ed-comments{margin-top:12px;border:1px solid var(--bor);border-radius:6px}
.ed-comments-head{padding:6px 10px;background:#f7f8fa;font-size:10px;font-weight:700;text-transform:uppercase;color:var(--dk2);border-bottom:1px solid var(--bor);cursor:pointer}
.ed-comments-body{padding:8px 10px}
.ed-cmt{padding:6px 0;border-bottom:1px solid #f5f5f5;font-size:11px}.ed-cmt:last-child{border-bottom:none}
.ed-cmt .cmt-meta{font-size:9.5px;color:var(--txtL);margin-bottom:2px}.ed-cmt .cmt-meta b{color:var(--dk)}
.ed-cmt.resolved{opacity:.5;text-decoration:line-through}
.ed-cmt-add{display:flex;gap:4px;margin-top:6px}.ed-cmt-add input{flex:1;padding:4px 6px;border:1px solid var(--bor);border-radius:3px;font-size:11px;outline:none}
.ed-cmt-add button{padding:4px 10px;background:var(--o);color:#fff;border:none;border-radius:3px;cursor:pointer;font-size:10px;font-weight:600}
.tr-row{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
.tr-badge{font-size:9px;padding:2px 6px;border-radius:3px;font-weight:600}
.tr-badge.ok{background:var(--grL);color:var(--gr)}.tr-badge.out{background:#FFF3CD;color:#856404}.tr-badge.miss{background:#F8D7DA;color:#721C24}
.ld{position:fixed;inset:0;background:var(--dk);display:flex;align-items:center;justify-content:center;z-index:999;flex-direction:column;gap:14px}
.ld .sp{width:32px;height:32px;border:3px solid rgba(255,255,255,.12);border-top-color:var(--o);border-radius:50%;animation:spin .6s linear infinite}
.ld p{color:rgba(255,255,255,.5);font-size:12px}@keyframes spin{to{transform:rotate(360deg)}}
[dir="rtl"] .col-left{border-right:none;border-left:1px solid var(--bor)}[dir="rtl"] .col-right{border-left:none;border-right:1px solid var(--bor)}
[dir="rtl"] .chb{padding-left:0;padding-right:12px}[dir="rtl"] .s-wrap input{padding-left:8px;padding-right:26px}[dir="rtl"] .s-wrap .ico{left:auto;right:7px}
</style>
</head>
<body>
<div class="ld" id="ld"><div class="sp"></div><p>Loading STM RFQ Configurator...</p></div>
<div class="topbar"><div class="logo">STM<span>GROUP</span></div><div class="spacer"></div><div class="lang-bar" id="lang-bar"></div><button class="btn-exp" onclick="exportToWord()">‚¨á Word Export</button></div>
<div class="tabbar"><button class="on" onclick="switchTab('config',this)">üìã Configurator</button><button onclick="switchTab('editor',this)">‚úèÔ∏è Block Editor</button></div>

<!-- TAB 1: CONFIGURATOR -->
<div class="tab-page active" id="tab-config">
  <div class="col-left" id="col-left"><div class="scroll">
    <div class="sel-box" id="psel"><label>üîç PROJECT</label><div class="s-wrap"><span class="ico">‚åï</span><input id="ps" placeholder="Zoek project..." oninput="fP()" onfocus="sDD('p')" autocomplete="off"><div class="dd" id="pdd"></div></div><div id="ptag" style="display:none"></div></div>
    <div class="sel-box" id="ssel"><label>üè¢ LEVERANCIER</label><div class="s-wrap"><span class="ico">‚åï</span><input id="ss" placeholder="Zoek leverancier..." oninput="fS()" onfocus="sDD('s')" autocomplete="off"><div class="dd" id="sdd"></div></div><div id="stag" style="display:none"></div></div>
    <div class="meta-row"><div><label>Scope</label><input id="i-scope" placeholder="montage dak- en gevelbeplating" oninput="onScope()"></div></div>
    <div class="meta-row"><div><label>RFQ Nr.</label><input id="i-rfq"></div><div><label>Datum</label><input type="date" id="i-date"></div></div>
    <div style="margin:8px 0 4px;display:flex;align-items:center;justify-content:space-between"><span style="font-weight:600;font-size:10px;text-transform:uppercase;letter-spacing:.4px;color:var(--dk2)">Hoofdstukken</span><button onclick="resetAll()" style="font-size:9px;border:none;background:none;color:var(--o);cursor:pointer;font-weight:500">‚Üª Reset</button></div>
    <div id="chlist"></div>
  </div></div>
  <div class="drag-h" id="dl"></div>
  <div class="col-mid" id="col-mid"><div class="mid-sect"><h3>Variabelen per blok</h3></div><div class="scroll" id="mid-scroll"></div></div>
  <div class="drag-h" id="dr"></div>
  <div class="col-right" id="col-right"><div class="pv-head">üìÑ Preview</div><div class="scroll"><div class="pvb" id="pv"></div></div></div>
</div>

<!-- TAB 2: EDITOR -->
<div class="tab-page" id="tab-editor">
  <div class="ed-layout">
    <div class="ed-left"><div style="padding:8px 10px;border-bottom:1px solid var(--bor);font-weight:600;font-size:11px;color:var(--dk)">Chapters & Blocks</div><div class="scroll" id="ed-chlist"></div></div>
    <div class="ed-main">
      <div class="ed-top"><h3 id="ed-title">Block Editor</h3><button onclick="edImportJson()">üì• Import</button><button onclick="edExportJson()">üì§ Export JSON</button><button class="btn-save" onclick="edSave()">üíæ Save</button></div>
      <div class="ed-panel scroll" id="ed-panel"><div class="ed-empty" id="ed-empty">Select a block to edit</div><div id="ed-content" style="display:none"></div></div>
    </div>
  </div>
</div>

<script src="lib/jszip.min.js"></script>
<script src="lib/FileSaver.min.js"></script>
<script>
const PROJECTS=[{"nr": "STPR25004", "name": "BV Neubau Lagerhalle, Feldstr 22-24, Oberhausen", "addr": "Feldstr. 22-44", "zip": "49149", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2025-07-21", "end": "", "client": "Petra Bortz-Ittner", "clientCity": "Oberhausen"}, {"nr": "STP23006", "name": "Solar Carports Clinical Trial Services", "addr": "Gronausestraat 98", "zip": "7581 CJ", "city": "Losser", "exc": 0, "tol": 0, "start": "2023-01-16", "end": "2024-02-02", "client": "Clinical trial services BV", "clientCity": "Losser"}, {"nr": "STP19002", "name": "Fortior Fase 2; Nieuwbouw Bedrijfsverzamelgebouw", "addr": "De Reulver 30", "zip": "7544RT", "city": "Enschede", "exc": 0, "tol": 0, "start": "2019-02-04", "end": "", "client": "Fortior Real Estate BV", "clientCity": "Enschede"}, {"nr": "STPR23004", "name": "BV Ludwig Zenger, Kerpen, Neubau einer Lagerhalle", "addr": "Karl-Ferdinand-Braun-Stra√üe", "zip": "50170", "city": "Kerpen-Sindorf", "exc": 0, "tol": 0, "start": "2023-06-30", "end": "2024-12-20", "client": "Ludwig Zenger Industrie-Service GmbH", "clientCity": "Kerpen (T√ºrnich)"}, {"nr": "STPR24005", "name": "BV Buro mit Halle and Produktion Koln", "addr": "Picolloministrasse 23", "zip": "", "city": "Koln", "exc": 0, "tol": 0, "start": "2024-07-22", "end": "", "client": "Kar GmbH", "clientCity": "Koln"}, {"nr": "STP24002", "name": "Nieuwbouw BVG, Reulver, Enschede", "addr": "De Reulver 73", "zip": "7544RT", "city": "Enschede", "exc": 0, "tol": 0, "start": "2024-03-05", "end": "2026-02-27", "client": "Fortior Real Estate BV", "clientCity": "Enschede"}, {"nr": "STP25001", "name": "Nieuwbouw Padel Court, Cuijk", "addr": "Sint Annastraat 1", "zip": "5431BE", "city": "Cuijk", "exc": 0, "tol": 0, "start": "2025-02-06", "end": "", "client": "DuelPadel B.V.", "clientCity": "Almelo"}, {"nr": "STP23004", "name": "Woodstock Phase I;  Stigterstaal Canada inc.", "addr": "38 Garnet Road", "zip": "N3T 5M1", "city": "Brantford, ON", "exc": 0, "tol": 0, "start": "2023-02-02", "end": "2025-07-31", "client": "Stigterstaal B.V.", "clientCity": "GORINCHEM"}, {"nr": "STPR19010", "name": "BV Selha; Lager Halle 5200m2, Koln, DE", "addr": "Bunsenstrasse 6-2", "zip": "D-41540", "city": "Dormagen", "exc": 0, "tol": 0, "start": "2021-11-16", "end": "", "client": "HM Immobilien- & Verm√∂gensgesellschaft mbH", "clientCity": "Hagen"}, {"nr": "STPR19020", "name": "BV Demka, Lagerhalle + Buro 7450 m2, Mannheim", "addr": "Lembacherstrasse", "zip": "", "city": "Mannheim", "exc": 0, "tol": 0, "start": "2019-09-30", "end": "", "client": "Arzu + Esme Demirdas GbR", "clientCity": "Mannheim"}, {"nr": "STP25012", "name": "Environmental permit & Fireproof Safes Twimva", "addr": "Jaargetijdenweg 33,", "zip": "7532 SX", "city": "Enschede", "exc": 0, "tol": 0, "start": "2025-10-02", "end": "", "client": "Automotive & Refinish BV", "clientCity": "Enschede"}, {"nr": "STPR21002", "name": "BV Fruechte Boquoi, Hagen, DE", "addr": "Neustrasse 15", "zip": "58135", "city": "Hagen", "exc": 0, "tol": 0, "start": "2022-04-04", "end": "2023-12-05", "client": "Birgit Kerenciler", "clientCity": "Gevelsberg"}, {"nr": "STPR23006", "name": "BV Halle Au√üen Lager 2, Duisburg", "addr": "Rheindeichstrasse 155", "zip": "47199", "city": "Duisburg", "exc": 0, "tol": 0, "start": "2024-01-15", "end": "2024-04-19", "client": "Bt building technologies GmbH", "clientCity": "K√∂ln"}, {"nr": "STP25003", "name": "Nieuwbouw Wesealit, Josink-Es, Enschede", "addr": "Josin kolkweg 10", "zip": "7545PJ", "city": "Enschede", "exc": 0, "tol": 0, "start": "2025-03-12", "end": "", "client": "Weasealit BV", "clientCity": "Enschede"}, {"nr": "STPR24001", "name": "BV Neubau Buro mit Halle, FLIX die fahrschuhle", "addr": "Piccoloministrasse", "zip": "51063", "city": "Koln", "exc": 0, "tol": 0, "start": "2024-01-19", "end": "", "client": "FLIX die Fahrschule", "clientCity": "Koln"}, {"nr": "STPR24006", "name": "BV FreshPark, Dormagen", "addr": "Kruppstrasse 84", "zip": "41540", "city": "Dormagen", "exc": 0, "tol": 0, "start": "2024-09-13", "end": "", "client": "Edeholz GmbH", "clientCity": "Hagen"}, {"nr": "STPR21008", "name": "BV Alfafood Verkaufshalle und Lager sowie Fitnessstudio", "addr": "Schwabenstra√üe 38,", "zip": "93053", "city": "Regensburg", "exc": 0, "tol": 0, "start": "2021-05-14", "end": "", "client": "Alfafood GmbH", "clientCity": "N√ºrnberg"}, {"nr": "STPR21010", "name": "BV Coil Lager mit Buro", "addr": "Schwerter Strasse 19", "zip": "58099", "city": "Hagen", "exc": 0, "tol": 0, "start": "2021-08-30", "end": "", "client": "Fritz Neuhaus GmbH", "clientCity": "Hagen"}, {"nr": "STPR23005", "name": "BV Renovierung Denkmalschutz Gebaude, Gronau", "addr": "Fabriekstrasse 11", "zip": "", "city": "Gronau", "exc": 0, "tol": 0, "start": "2023-07-28", "end": "", "client": "Nergiz GmbH & Co. KG", "clientCity": "Gronau"}, {"nr": "STP23014", "name": "Nieuwbouw Flex-housing, Ontwikkeling Almelo 3x36st", "addr": "Aaddijk 18", "zip": "7610AA", "city": "Almelo", "exc": 0, "tol": 0, "start": "2023-09-28", "end": "", "client": "Kinada Vastgoed BV", "clientCity": "Almelo"}, {"nr": "STP24003", "name": "Reclamaties 2024", "addr": "Marssteden 52", "zip": "7447TC", "city": "Enschede", "exc": 0, "tol": 0, "start": "2024-03-20", "end": "", "client": "PATboard B.V.", "clientCity": "Enschede"}, {"nr": "STP24001", "name": "Nieuwbouw Mondial Pack BV, Marssteden, Enschede", "addr": "Marssteden 36", "zip": "7547TC", "city": "Enschede", "exc": 0, "tol": 0, "start": "2024-01-12", "end": "", "client": "De Bleekhoek BV", "clientCity": "Enschede"}, {"nr": "STPR23007", "name": "Vertikal-transport ausbau und Laderampe", "addr": "Piccoloministra√üe 22", "zip": "51063", "city": "K√∂ln", "exc": 0, "tol": 0, "start": "2023-11-17", "end": "", "client": "Maho GmbH", "clientCity": "Koln"}, {"nr": "STP21011", "name": "Nieuwbouw Floret, Logistiek centrum met kantoor, Heinenoord", "addr": "Zaaiviool/Sikkel", "zip": "", "city": "Heienoord", "exc": 0, "tol": 0, "start": "2021-06-14", "end": "2023-04-28", "client": "Floret Holding B.V.", "clientCity": "Rotterdam"}, {"nr": "STPR19014", "name": "BV Ninos, Neubau Lagerhalle + Buro 1.483m2, Borgwardstrasse", "addr": "Einstein-Ring", "zip": "48599", "city": "Gronau", "exc": 0, "tol": 0, "start": "2019-07-24", "end": "", "client": "Ninos Shamon", "clientCity": "Gronau"}, {"nr": "STP22017", "name": "Venlo Containerterminal Solarconstruction", "addr": "Venlo", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2022-11-29", "end": "", "client": "CMS Energiesystemen B.V.", "clientCity": "Horst"}, {"nr": "ST23019", "name": "Boiler and Furnace Platform", "addr": "Romania", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2023-06-09", "end": "", "client": "Host Thermal Technology BV", "clientCity": "Enschede"}, {"nr": "ST22042", "name": "De Sport Fabrik BV Uitbreiding + dak sportrek", "addr": "Smitsbreeweg 8,", "zip": "7581 HE", "city": "Losser", "exc": 0, "tol": 0, "start": "2022-10-12", "end": "", "client": "De Sport Fabrik BV", "clientCity": "Losser"}, {"nr": "STP22002", "name": "Nieuwbouw Hal Broekhoekweg, Losser", "addr": "Broekhoiekweg 36", "zip": "", "city": "Losser", "exc": 0, "tol": 0, "start": "2022-01-10", "end": "", "client": "GBJ Luttikhuis Holding BV", "clientCity": "Losser"}, {"nr": "STPR18004", "name": "BV Buram, Produktion & Lager Gebaude", "addr": "Heidering 10", "zip": "16727", "city": "Velten", "exc": 0, "tol": 0, "start": "2018-06-27", "end": "", "client": "Buram GmbH", "clientCity": "Hennigsdorf"}, {"nr": "STPR22007", "name": "BV Produktionshalle mit Buro, Witten, DE", "addr": "Feldstrasse 1", "zip": "58456", "city": "Witten", "exc": 0, "tol": 0, "start": "2022-05-25", "end": "", "client": "Ruhrtaler Gesenkschmiede F.W. Wengeler GmbH & Co. KG", "clientCity": "Witten"}, {"nr": "STP22010", "name": "Uitbreiding Bestaande Hal, TNR Vastgoed, Almelo", "addr": "planthofsweg 43", "zip": "7601PH", "city": "Almelo", "exc": 0, "tol": 0, "start": "2022-05-23", "end": "", "client": "TNR Vastgoed BV", "clientCity": "Almelo"}, {"nr": "ST22044", "name": "Controleberekening Zonnepanelen", "addr": "Metaalstraat 22", "zip": "7483PD", "city": "", "exc": 0, "tol": 0, "start": "2022-10-19", "end": "2022-11-23", "client": "Gemini Techniek B.V.", "clientCity": "Haaksbergen"}, {"nr": "STPR19009", "name": "BV Nergiz; 8532m2 Multifunktions Gebaude + 2532m2 Uberdachun", "addr": "Fabriekstrasse 1", "zip": "48455", "city": "Gronau", "exc": 0, "tol": 0, "start": "2019-05-29", "end": "", "client": "Nergiz GmbH & Co. KG", "clientCity": "Gronau"}, {"nr": "STP21015", "name": "Renovatie Bestaand gebouw, de Mars 9, Coevorden", "addr": "De mars 9", "zip": "", "city": "Coevorden", "exc": 0, "tol": 0, "start": "2021-10-12", "end": "2022-12-23", "client": "Wepart BV", "clientCity": "Neede"}, {"nr": "STPR21005", "name": "BV Alfafood, Renovierung, Nurnberg", "addr": "Platenstra√üe 65", "zip": "90441", "city": "N√ºrnberg", "exc": 0, "tol": 0, "start": "2021-03-12", "end": "", "client": "Alfafood GmbH", "clientCity": "N√ºrnberg"}, {"nr": "STP21003", "name": "Nieuwbouw Overslaghal De Mars, Coevorden", "addr": "De Mars", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2021-03-19", "end": "", "client": "Wepart BV", "clientCity": "Neede"}, {"nr": "STP21005", "name": "Nieuwbouw Hassing Totaalstoffering, Josink-Es", "addr": "Josink-Es", "zip": "", "city": "Enschede", "exc": 0, "tol": 0, "start": "2021-04-08", "end": "", "client": "REHAS BV", "clientCity": "Enschede"}, {"nr": "STP18002", "name": "Beladingsgebouw HCM Moerdijk", "addr": "Vlasweg 11b", "zip": "", "city": "Moerdijk", "exc": 0, "tol": 0, "start": "2018-01-26", "end": "", "client": "Meyland N.V.", "clientCity": "ADEGEM"}, {"nr": "STP17003", "name": "Aufstockung, Gewa Oberhausen", "addr": "Fannhorststrasse 13", "zip": "46117", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2017-03-03", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "STP15007", "name": "Pflanzenhalle Voerde", "addr": "Hindenburgstra√üe", "zip": "46562", "city": "Voerde", "exc": 0, "tol": 0, "start": "2015-12-03", "end": "", "client": "Andr√© Lackas", "clientCity": "Wesel"}, {"nr": "STP15008", "name": "Feuerwache, Voerde", "addr": "Hindenburgstra√üe", "zip": "46562", "city": "Voerde", "exc": 0, "tol": 0, "start": "2015-12-03", "end": "", "client": "Andr√© Lackas", "clientCity": "Wesel"}, {"nr": "STP16004", "name": "Neubau Lagerhalle mit integriertes B√ºro", "addr": "Rheinfelser Stra√üe 116", "zip": "35398", "city": "Gie√üen", "exc": 0, "tol": 0, "start": "2016-04-08", "end": "", "client": "Natur Food GmbH", "clientCity": "Aschaffenburg"}, {"nr": "STP16005", "name": "Neubau Lagerhalle Nergiz mit verkaufstatte", "addr": "Borgwardstra√üe", "zip": "", "city": "Gronau", "exc": 0, "tol": 0, "start": "2016-04-22", "end": "", "client": "Nergiz GmbH & Co. KG", "clientCity": "Gronau"}, {"nr": "STP14003", "name": "V-tron staalconstructie tussenvloer, doorbraak, afbouw", "addr": "Zweedsestraat 6", "zip": "7418 BG", "city": "Deventer", "exc": 0, "tol": 0, "start": "2014-11-13", "end": "2014-12-23", "client": "V-Tron Vastgoed B.V.", "clientCity": "DEVENTER"}, {"nr": "ST17092", "name": "Waterrijk Oesterdam", "addr": "Tholen", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2017-12-07", "end": "2019-07-26", "client": "Sprangers Bouwbedrijf B.V.", "clientCity": "BREDA"}, {"nr": "STP20003", "name": "Nieuwbouw Garage bedrijf Luttikhuis", "addr": "Broekhoekweg 20", "zip": "7582PT", "city": "Losser", "exc": 0, "tol": 0, "start": "2020-03-04", "end": "", "client": "GBJ Luttikhuis Holding BV", "clientCity": "Losser"}, {"nr": "ST21071", "name": "Controle berekening verrijdbare hal Hoebee met zwaardere kra", "addr": "Merwedestraat 56,", "zip": "3313 CS", "city": "Dordrecht", "exc": 0, "tol": 0, "start": "2021-12-08", "end": "", "client": "Scheepswerf Kooiman Hoebee B.V.", "clientCity": "Dordrecht"}, {"nr": "STP16006", "name": "BV Wieland & Jarasch", "addr": "Oberhausen", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2016-08-26", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "STPR21001", "name": "BV EFEOGLU ET, Neubau einer betreibsstaette, Koln", "addr": "Garzweilerweg/Schleyerhofweg", "zip": "50829", "city": "Koln", "exc": 0, "tol": 0, "start": "2021-01-11", "end": "", "client": "Suedlaendische Feinkost GmbH", "clientCity": "K√∂ln"}, {"nr": "STPR21003", "name": "BV BSG Denkmalschutz Gebaude, Hotel, Wohnungen, Nergiz", "addr": "Industriestrasse 11", "zip": "48455", "city": "Gronau", "exc": 0, "tol": 0, "start": "2021-02-15", "end": "", "client": "Nergiz Projektentwicklung GmbH", "clientCity": "GRONAU"}, {"nr": "STP22005", "name": "Uitbreiding Garagebedrijf A&J, Huizen", "addr": "Nijvrheidsweg 26", "zip": "", "city": "Huizen", "exc": 0, "tol": 0, "start": "2022-02-14", "end": "", "client": "Smelt Holding B.V", "clientCity": "Amsterdam"}, {"nr": "STPR21022", "name": "BV Neubau Logistik Zentrum Gronau, Monari", "addr": "Borgsigstrasse 14", "zip": "48599", "city": "Gronau", "exc": 0, "tol": 0, "start": "2021-12-20", "end": "", "client": "Monari Immobilien GmbH", "clientCity": "Gronau"}, {"nr": "STPR19001", "name": "Omar Erweiterung Lager Halle, 15 x 5 meter", "addr": "Schurblick 5A", "zip": "", "city": "Gronau", "exc": 0, "tol": 0, "start": "2019-01-03", "end": "", "client": "Nourzia Omar-Nasrat", "clientCity": "Gronau"}, {"nr": "STPR19012", "name": "BV Af-Pack, Neubau einer Lagerhalle 2.300m2", "addr": "Bornstra√üe 273", "zip": "44145", "city": "Dortmund", "exc": 0, "tol": 0, "start": "2019-06-28", "end": "", "client": "KO-DI Grundstuecksgemeinschaft GbR", "clientCity": "Dortmund"}, {"nr": "STPR18001", "name": "Kuch BV Gewerbe Halle Orsoy, Meldeweg", "addr": "Meldeweg 5", "zip": "47495", "city": "Rheinberg", "exc": 0, "tol": 0, "start": "2018-03-06", "end": "", "client": "Ute Kuch", "clientCity": "Rheinberg"}, {"nr": "STPR19013", "name": "Lieferung Stahlkonstruktion + Dach Anbau Wohung Philippe Sch", "addr": "Losserstrasse 109", "zip": "", "city": "Gronau", "exc": 0, "tol": 0, "start": "2019-07-22", "end": "", "client": "Philippe Schol", "clientCity": "Gronau"}, {"nr": "STP22003", "name": "Vervangen Overheaddeur", "addr": "Avelingen West 10", "zip": "4202 MS", "city": "Gorinchem", "exc": 0, "tol": 0, "start": "2022-01-17", "end": "", "client": "Stigterstaal B.V.", "clientCity": "GORINCHEM"}, {"nr": "STPR17007", "name": "Barkhofen Eventausstattung √úberdachung 32*12mtr Dinslaken", "addr": "Dieselstra√üe 13", "zip": "46539", "city": "Dinslaken", "exc": 0, "tol": 0, "start": "2017-10-12", "end": "", "client": "Barkhofen B√ºro & Betriebsgel√§nde", "clientCity": "Dinslaken"}, {"nr": "STP18003", "name": "Fortior Fase 1; Stanora Logistieke Hal + Dockhouses", "addr": "De Reulver", "zip": "7544 RT", "city": "Enschede", "exc": 0, "tol": 0, "start": "2018-03-16", "end": "", "client": "Fortior Real Estate BV", "clientCity": "Enschede"}, {"nr": "STP21002", "name": "Kooiman; Verbouwen best loodsen", "addr": "Lindtsedijk 84", "zip": "3336LE", "city": "Zwijndrecht", "exc": 0, "tol": 0, "start": "2021-02-03", "end": "", "client": "Scheepswerf Gebroeders Kooiman B.V.", "clientCity": "Zwijndrecht"}, {"nr": "STPR21006", "name": "BV Alfafood; Neue Wand", "addr": "Draisstrasse 2B", "zip": "91522", "city": "Ansbach", "exc": 0, "tol": 0, "start": "2021-04-07", "end": "", "client": "Alfafood GmbH", "clientCity": "N√ºrnberg"}, {"nr": "STP21013", "name": "double number cancelled", "addr": "Buurserstraat 212", "zip": "7544 RG", "city": "Enschede", "exc": 0, "tol": 0, "start": "2021-10-05", "end": "", "client": "Staalmeesters Projects BV", "clientCity": "Losser"}, {"nr": "STP19007", "name": "Nieuwbouw PATboard BV, Josink Es, Enschede", "addr": "Josink Es", "zip": "", "city": "Enschede", "exc": 0, "tol": 0, "start": "2019-06-19", "end": "", "client": "PATzest B.V.", "clientCity": "Enschede"}, {"nr": "STP19004", "name": "Meyland; STC Eurochem", "addr": "Eurochem", "zip": "", "city": "Antwerpen", "exc": 0, "tol": 0, "start": "2019-03-13", "end": "", "client": "Meyland N.V.", "clientCity": "ADEGEM"}, {"nr": "STPR20004", "name": "BV Eurofrucht, 2700m2 Lagerhalle + Buro, Hettstedt", "addr": "Ritterroeder Strasse", "zip": "", "city": "Hettstedt", "exc": 0, "tol": 0, "start": "2020-09-21", "end": "", "client": "Eurofrucht", "clientCity": "Hettstedt"}, {"nr": "STP19008", "name": "Crown Food XL; Opslag hal met inpandig kantoor", "addr": "Osseboer", "zip": "", "city": "Enschede", "exc": 0, "tol": 0, "start": "2019-09-13", "end": "", "client": "Jeruzalem Onroerend Goed B.V.", "clientCity": "Enschede"}, {"nr": "ST18065", "name": "Nieuwbouw Twentseplaten specialist BV", "addr": "Twentepoort", "zip": "", "city": "Almelo", "exc": 0, "tol": 0, "start": "2018-12-17", "end": "", "client": "Olde Hensken Vastgoed B.V.", "clientCity": "Almelo"}, {"nr": "STP19005", "name": "Nieuwbouw Impexstaal", "addr": "Avelingen-West 2-6", "zip": "", "city": "Gorinchem", "exc": 0, "tol": 0, "start": "2019-03-26", "end": "", "client": "Impexstaal Holding BV", "clientCity": "Gorinchem"}, {"nr": "STPR19018", "name": "BV NeickenPartner, Erweiterung der betriebsst√§tte", "addr": "weissensteinstr. 90b", "zip": "46149", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2019-09-02", "end": "", "client": "Neickenpartner Licht- und Werbetechnik GmbH", "clientCity": "OBERHAUSEN"}, {"nr": "STPR19007", "name": "Neubau Trinity Immobilien BV", "addr": "Brusselerstrasse", "zip": "48455", "city": "Gilde hausen", "exc": 0, "tol": 0, "start": "2019-03-13", "end": "", "client": "Trinity Immobilien B.V.", "clientCity": "Oldenzaal"}, {"nr": "STP20005", "name": "Coeck Cladding del&erect, STC erect", "addr": "Coeck De Laetstraat 6", "zip": "2845", "city": "Niel", "exc": 0, "tol": 0, "start": "2020-05-29", "end": "", "client": "Meyland N.V.", "clientCity": "ADEGEM"}, {"nr": "STP20004", "name": "Cross-Fit Kooi", "addr": "Smitsbreeweg 8,", "zip": "7581HE", "city": "Losser", "exc": 0, "tol": 0, "start": "2020-05-14", "end": "", "client": "EBS Holding BV", "clientCity": "Enschede"}, {"nr": "STP19010", "name": "Fortior Fase 3; De Reulver 53-55", "addr": "De reulver 53-55", "zip": "", "city": "Enschede", "exc": 0, "tol": 0, "start": "2019-09-30", "end": "", "client": "Fortior Real Estate BV", "clientCity": "Enschede"}, {"nr": "STP17001", "name": "Projekt Nergiz Fabrikstra√üe 11, Gronau", "addr": "Gronau", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2017-01-24", "end": "2017-08-22", "client": "Nergiz GmbH & Co. KG", "clientCity": "Gronau"}, {"nr": "STP15001", "name": "Erweiterung Sultan Halle und Buro", "addr": "Koln", "zip": "", "city": "Koln", "exc": 0, "tol": 0, "start": "2015-05-07", "end": "", "client": "Oktay Uludogan", "clientCity": "BERGISCH GLADBACH"}, {"nr": "ST18048", "name": "Controle berekening brug Mouterij albert", "addr": "Antwerpen", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2018-09-12", "end": "", "client": "Meyland N.V.", "clientCity": "ADEGEM"}, {"nr": "STP18008", "name": "Serre 17x7x3m aan bestaand pand", "addr": "Haaksbergerstraat 166-1", "zip": "7554PB", "city": "Hengelo", "exc": 0, "tol": 0, "start": "2018-11-28", "end": "", "client": "Holland Middle East Trading BV", "clientCity": "ENSCHEDE"}, {"nr": "ST17084", "name": "18 no. THQ Steel beams, Ambu, Ballerup, Denmark", "addr": "Ambu A/S Baltorpparken 13", "zip": "2750", "city": "Ballerup", "exc": 0, "tol": 0, "start": "2017-10-24", "end": "", "client": "Stal & Design A/S", "clientCity": "N√¶stved"}, {"nr": "STPR17002", "name": "Uitbouw Hotel Schurblick 9, Gronau", "addr": "Sch√ºrblick 9", "zip": "48599", "city": "Gronau", "exc": 0, "tol": 0, "start": "2017-07-03", "end": "", "client": "Nergiz GmbH & Co. KG", "clientCity": "Gronau"}, {"nr": "STP16008", "name": "Entwurf Pisulla", "addr": "Kirchhellener Stra√üe", "zip": "46145", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2016-12-21", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "ST17004", "name": "Verlenging Slipway Damex", "addr": "Santiago de Cuba", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2017-01-16", "end": "", "client": "Damen Shipyards Gorinchem B.V.", "clientCity": "GORINCHEM"}, {"nr": "ST15147", "name": "BV2222 Bayreuth", "addr": "Am Bauhof 5", "zip": "D-95445", "city": "Bayreuth", "exc": 0, "tol": 0, "start": "2015-12-02", "end": "", "client": "PEM GmbH Landshut (Deutschland)", "clientCity": "Landshut"}, {"nr": "STP15002", "name": "Erweiterung Autowerkstatt Mercedes Becker", "addr": "Max-Eyth-Strass 1", "zip": "46149", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2015-05-07", "end": "", "client": "Beckergrundst√ºcksverwaltung GmbH & Co KG", "clientCity": "Oberhausen"}, {"nr": "STP14001", "name": "Neubau Yamaha", "addr": "Duisburger StraBe 100", "zip": "", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2014-09-22", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "ST14045", "name": "Fa. Hilti", "addr": "Oberhausen", "zip": "", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2014-04-04", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "ST16062", "name": "LBK frames", "addr": "VAF instruments", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2016-05-18", "end": "", "client": "Van Dorp installaties B.V.", "clientCity": "Zoetermeer"}, {"nr": "ST16091", "name": "Purlin Supports HDG", "addr": "Moerdijk", "zip": "", "city": "", "exc": 0, "tol": 0, "start": "2016-07-06", "end": "", "client": "Hafkon International BV", "clientCity": "Nieuwkuijk"}, {"nr": "ST15133", "name": "Ondersteunings constructie wheel Pier Scheveningen", "addr": "Strandweg", "zip": "", "city": "Scheveningen", "exc": 0, "tol": 0, "start": "2015-11-04", "end": "", "client": "Bakels en Ouwerkerk Bouw", "clientCity": "'s-GRAVENHAGE"}, {"nr": "STP15006", "name": "Neubau einen Lagerhalle Ute Kuch", "addr": "Rheinbergstra√üe 192a", "zip": "47495", "city": "Rheinberg", "exc": 0, "tol": 0, "start": "2015-08-07", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "STP15003", "name": "Bv Minnebusch", "addr": "Oberhausen", "zip": "", "city": "Oberhausen", "exc": 0, "tol": 0, "start": "2015-06-29", "end": "", "client": "Plassmeier GmbH", "clientCity": "Oberhausen"}, {"nr": "ST15145", "name": "71357 Bundle frame & Steelconstruction", "addr": "Nijkerk", "zip": "", "city": "Nijkerk", "exc": 0, "tol": 0, "start": "2015-11-23", "end": "", "client": "Bronswerk Heat Transfer B.V.", "clientCity": "NIJKERK"}, {"nr": "ST15051", "name": "Staalconstructies van project WPB Lith", "addr": "Lith", "zip": "", "city": "Lith", "exc": 0, "tol": 0, "start": "2015-10-01", "end": "", "client": "RWB Water Services BV", "clientCity": "Almelo"}, {"nr": "ST14119", "name": "BV2053 Steelconstruction Bamberg", "addr": "Bamberg", "zip": "D-96047", "city": "Bamberg", "exc": 0, "tol": 0, "start": "2014-10-15", "end": "2014-11-18", "client": "PEM GmbH Landshut (Deutschland)", "clientCity": "Landshut"}, {"nr": "ST13124", "name": "Silo onderbouw Kastenmueller", "addr": "Hafenstr 6", "zip": "48480", "city": "Spelle/Duitsland", "exc": 0, "tol": 0, "start": "2013-06-25", "end": "2013-08-12", "client": "Top-Siloconstructions B.V.", "clientCity": "AALTEN"}, {"nr": "ST15003", "name": "Door Shipyard Cuba", "addr": "Cuba", "zip": "", "city": "Santiago de Cuba", "exc": 0, "tol": 0, "start": "2015-01-06", "end": "", "client": "Damen Shipyards Gorinchem B.V.", "clientCity": "GORINCHEM"}, {"nr": "ST15028", "name": "71318 Bundleframe", "addr": "Nijkerk", "zip": "", "city": "Nijkerk", "exc": 0, "tol": 0, "start": "2015-02-23", "end": "", "client": "Bronswerk Heat Transfer B.V.", "clientCity": "NIJKERK"}, {"nr": "ST15048", "name": "1936-THQ liggers Kinepolis", "addr": "Dordrecht", "zip": "", "city": "Dordrecht", "exc": 0, "tol": 0, "start": "2015-03-31", "end": "", "client": "Oostingh Staalbouw", "clientCity": "KATWIJK"}, {"nr": "ST15057", "name": "Schuifdeuren achterzijde hal 4", "addr": "Moerdijk", "zip": "", "city": "Moerdijk", "exc": 0, "tol": 0, "start": "2015-04-28", "end": "", "client": "Bruinsma Vastgoed B.V.", "clientCity": "MOERDIJK"}, {"nr": "ST15091", "name": "Square Amsterdam", "addr": "Amsterdam", "zip": "", "city": "Amsterdam", "exc": 0, "tol": 0, "start": "2015-07-15", "end": "", "client": "Metaalsluis B.V.", "clientCity": "GENEMUIDEN"}];
const BTYPES={"110": "01.00 Bank", "1623": "02.00 Kantoorartikelen & printer", "3189": "03.00 Vergunningen", "3190": "04.00 Technisch ontwikkelen", "3191": "09.00 Projectmanagement", "3192": "05.00 Bouwplaatsvoorzieningen", "1621": "07.00 Transport", "3216": "08.00 Reiniging", "3248": "10.00 Stut- en Sloopwerkzaamheden", "1620": "12.00 Grondwerk", "3246": "15.00 Terreinverharding", "3195": "16.00 Beplanting", "3242": "17.00 Terreininrichting", "3243": "17.51 Timmerwerk", "3224": "20.00 Funderingspalen en Damwanden", "3175": "21.50 Beton in het werk gestort", "3225": "21.51 Beton in het werk gestort, Monolitisch Afgewerkt", "3247": "21.72 Beton Boringen", "3245": "21.82 Ankers en Bevestigingsmiddelen", "3220": "22.00 Heiwerkzaamheden", "3173": "23.00 Prefab betonnen onderdelen", "111": "24.00 Bouwkundige aannemer", "1619": "25.00 Metaalconstructie bedrijf", "3199": "25.31 Montage Metaalskelet", "3181": "27.00 Ankers en bevestigingsmaterialen", "3228": "28.00 Bouwmaterialen", "3178": "30.00 Deuren, ramen & dakluiken", "3200": "31.00 Dak- & Wandbekleding", "3201": "032 Trappen en balustrades", "3179": "033 Dakbedekking", "3202": "035 Natuursteen", "3203": "040 Stucadoor", "3219": "041 Vloerafwerkingen", "3177": "046.00 Schilderwerk", "3204": "047 Binnenopstellingen & decoratie", "3205": "052 Water installatie", "3206": "054 Brandbeveiliging", "3207": "060 Verwarmings- & ventilatie installatie", "3208": "062 Koelinstallaties", "3174": "070 Elektrische installaties", "3217": "075 Alarm installatie", "3209": "080 Trap & Lift installaties", "3221": "085 Binnen installaties", "1957": "090 Andere", "3180": "095 Accountants", "3218": "096 Auto"};
let PG08=null,SUPPLIERS=[],templateData=null;
const S={lang:'nl',project:null,supplier:null,sel:new Set(),vals:{},supVars:{},delBlocks:new Set()};
const PVM={projectNumber:'nr',projectName:'name',siteAddress:'addr',siteZipcode:'zip',siteCity:'city',clientName:'client',assemblyStartDate:'start'};
const LANGS=[{c:'nl',f:'üá≥üá±',l:'NL'},{c:'en',f:'üá¨üáß',l:'EN'},{c:'de',f:'üá©üá™',l:'DE'},{c:'sk',f:'üá∏üá∞',l:'SK'},{c:'fa',f:'üáÆüá∑',l:'FA'}];
function t(k){return({nl:{dS:'Geachte heer/mevrouw,',dR:'Met vriendelijke groet,',del:'Geheel door leverancier',sup:'Door leverancier',noB:'Selecteer blokken in het linker paneel'},en:{dS:'Dear Sir/Madam,',dR:'Kind regards,',del:'Entire block by supplier',sup:'By supplier',noB:'Select blocks in the left panel'},de:{dS:'Sehr geehrte Damen und Herren,',dR:'Mit freundlichen Gr√º√üen,',del:'Gesamter Block durch Lieferant',sup:'Durch Lieferant',noB:'W√§hlen Sie Bausteine links'},sk:{dS:'V√°≈æen√Ω p√°n/pani,',dR:'S pozdravom,',del:'Cel√Ω blok dod√°vateƒæom',sup:'Dod√°vateƒæom',noB:'Vyberte bloky vƒæavo'},fa:{dS:'ÿ®ÿß ÿßÿ≠ÿ™ÿ±ÿßŸÖÿå',dR:'ÿ®ÿß ÿ™ÿ¥⁄©ÿ±ÿå',del:'⁄©ŸÑ ÿ®ŸÑŸà⁄© ÿ™Ÿàÿ≥ÿ∑ ÿ™ÿßŸÖ€åŸÜ‚Äå⁄©ŸÜŸÜÿØŸá',sup:'ÿ™Ÿàÿ≥ÿ∑ ÿ™ÿßŸÖ€åŸÜ‚Äå⁄©ŸÜŸÜÿØŸá',noB:'ÿ®ŸÑŸà⁄©‚ÄåŸáÿß ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ'}})[S.lang]?.[k]||k}
const L=o=>{if(!o)return'';if(typeof o==='string')return o;return o[S.lang]||o.nl||o.en||Object.values(o)[0]||''};
const esc=s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');

function switchTab(id,btn){document.querySelectorAll('.tab-page').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tabbar button').forEach(b=>b.classList.remove('on'));document.getElementById('tab-'+id).classList.add('active');btn.classList.add('on');if(id==='editor')edRenderList()}
function buildLang(){document.getElementById('lang-bar').innerHTML=LANGS.map(l=>'<button class="'+(l.c===S.lang?'on':'')+'" onclick="setLang(\''+l.c+'\')">'+l.f+' '+l.l+'</button>').join('')}
function setLang(c){S.lang=c;document.documentElement.lang=c;document.documentElement.dir=c==='fa'?'rtl':'ltr';buildLang();renderCh();renderMid();renderPv()}

// PROJECT
function fP(){var q=document.getElementById('ps').value.toLowerCase().trim(),dd=document.getElementById('pdd');if(!q){dd.classList.remove('show');return}
var m=PROJECTS.filter(function(p){return p.nr.toLowerCase().indexOf(q)>=0||p.name.toLowerCase().indexOf(q)>=0||p.city.toLowerCase().indexOf(q)>=0||p.client.toLowerCase().indexOf(q)>=0}).slice(0,12);
dd.innerHTML=m.map(function(p,i){return'<div class="di" onclick="selP('+i+')"><div class="m">'+esc(p.nr)+' ‚Äî '+esc(p.name)+'</div><div class="s">'+esc(p.city)+' ¬∑ '+esc(p.client)+'</div></div>'}).join('')||'<div class="di"><div class="s">Geen resultaten</div></div>';dd._matches=m;dd.classList.add('show')}
function selP(i){var dd=document.getElementById('pdd');var p=dd._matches[i];S.project=p;document.getElementById('ps').value='';dd.classList.remove('show');document.getElementById('ptag').style.display='block';document.getElementById('ptag').innerHTML='<div class="stag"><span class="nm">'+esc(p.nr)+' ‚Äî '+esc(p.name)+'</span><span class="cl" onclick="clrP()">√ó</span></div>';autoFill();renderMid();renderPv()}
function clrP(){S.project=null;document.getElementById('ptag').style.display='none';for(var bid in S.vals)for(var v in PVM)if(S.vals[bid]&&S.vals[bid][v])S.vals[bid][v]='';renderMid();renderPv()}
function autoFill(){if(!S.project||!PG08)return;PG08.chapters.forEach(function(ch){ch.blocks.forEach(function(bl){if(!S.vals[bl.id])S.vals[bl.id]={};(bl.variables||[]).forEach(function(v){var pk=PVM[v.id];if(pk&&S.project[pk])S.vals[bl.id][v.id]=S.project[pk]});
var sd=document.getElementById('i-scope').value;if(sd&&bl.variables&&bl.variables.some(function(v){return v.id==='scopeDescription'}))S.vals[bl.id].scopeDescription=sd})})}

// SUPPLIER
var BTO=['3199','3200','1619','3178','3192','1621'];
function fS(){var q=document.getElementById('ss').value.toLowerCase().trim(),dd=document.getElementById('sdd');if(!q){dd.classList.remove('show');return}
var m=SUPPLIERS.filter(function(s){return s.name.toLowerCase().indexOf(q)>=0||s.short.toLowerCase().indexOf(q)>=0||s.city.toLowerCase().indexOf(q)>=0});
m.sort(function(a,b){var ai=BTO.indexOf(a.bt),bi=BTO.indexOf(b.bt);return(ai<0?99:ai)-(bi<0?99:bi)||(a.name<b.name?-1:1)});
var h='',lb='';m.slice(0,18).forEach(function(s,i){if(s.bt!==lb){lb=s.bt;h+='<div class="dc">'+esc(BTYPES[s.bt]||'Other')+'</div>'}var cn=[s.fn,s.ln].filter(Boolean).join(' ');h+='<div class="di" onclick="selS('+i+')"><div class="m">'+esc(s.name)+'</div><div class="s">'+esc(s.city)+(cn?' ¬∑ '+esc(cn):'')+'</div></div>'});
dd.innerHTML=h||'<div class="di"><div class="s">Geen resultaten</div></div>';dd._matches=m.slice(0,18);dd.classList.add('show')}
function selS(i){var dd=document.getElementById('sdd');var s=dd._matches[i];S.supplier=s;document.getElementById('ss').value='';dd.classList.remove('show');document.getElementById('stag').style.display='block';var cn=[s.fn,s.ln].filter(Boolean).join(' ');document.getElementById('stag').innerHTML='<div class="stag"><span class="nm">'+esc(s.name)+(cn?'<br><span style="font-size:9px;color:var(--txtL)">'+esc(cn)+'</span>':'')+'</span><span class="cl" onclick="clrS()">√ó</span></div>';renderPv()}
function clrS(){S.supplier=null;document.getElementById('stag').style.display='none';renderPv()}
function sDD(type){var i=document.getElementById(type+'s');if(i.value.trim()){type==='p'?fP():fS()}}
document.addEventListener('click',function(e){if(!e.target.closest('#psel'))document.getElementById('pdd').classList.remove('show');if(!e.target.closest('#ssel'))document.getElementById('sdd').classList.remove('show')});
function onScope(){var sd=document.getElementById('i-scope').value;if(!PG08)return;PG08.chapters.forEach(function(ch){ch.blocks.forEach(function(bl){if(!S.vals[bl.id])S.vals[bl.id]={};if(bl.variables&&bl.variables.some(function(v){return v.id==='scopeDescription'}))S.vals[bl.id].scopeDescription=sd})});renderMid();renderPv()}

// CHAPTERS
function renderCh(){if(!PG08)return;var el=document.getElementById('chlist'),h='';
PG08.chapters.forEach(function(ch){var sc=ch.blocks.filter(function(b){return S.sel.has(b.id)}).length;var op=sc>0;
h+='<div class="chg'+(op?' open':'')+'" id="cg-'+ch.id+'"><div class="chh'+(op?' open':'')+'" onclick="tCh(\''+ch.id+'\')"><span class="ar">‚ñ∂</span><span class="cn">'+ch.number+'</span><span class="ct">'+esc(L(ch.title))+'</span><span class="cc">'+sc+'/'+ch.blocks.length+'</span></div><div class="chb">';
ch.blocks.forEach(function(bl){var on=S.sel.has(bl.id),dl=S.delBlocks.has(bl.id);h+='<div class="bli'+(on?' on':'')+(dl?' del':'')+'" data-b="'+bl.id+'"><div class="ck" onclick="event.stopPropagation();tBl(\''+bl.id+'\')">‚úì</div><div class="bl" onclick="tBl(\''+bl.id+'\')">'+esc(L(bl.label))+'</div>'+(dl?'<span class="bt">‚áÑ</span>':'')+'</div>'});
h+='</div></div>'});el.innerHTML=h}
function tCh(id){var g=document.getElementById('cg-'+id);g.classList.toggle('open');g.querySelector('.chh').classList.toggle('open')}
function tBl(id){if(S.sel.has(id)){S.sel.delete(id);S.delBlocks.delete(id)}else S.sel.add(id);renderCh();renderMid();renderPv()}

// MIDDLE: ALL BLOCKS
function renderMid(){if(!PG08)return;var el=document.getElementById('mid-scroll');
var sel=[];PG08.chapters.forEach(function(ch){var cb=ch.blocks.filter(function(b){return S.sel.has(b.id)});if(cb.length)sel.push({ch:ch,blocks:cb})});
if(!sel.length){el.innerHTML='<div class="empty-mid"><div class="ei">üìù</div><p>'+t('noB')+'</p></div>';return}
var h='';sel.forEach(function(g){
h+='<div style="padding:6px 8px 2px;font-size:11px;font-weight:700;color:var(--o)">'+g.ch.number+'. '+esc(L(g.ch.title))+'</div>';
g.blocks.forEach(function(bl){
var isDel=S.delBlocks.has(bl.id);if(!S.vals[bl.id])S.vals[bl.id]={};if(!S.supVars[bl.id])S.supVars[bl.id]={};var vars=bl.variables||[];
h+='<div class="bcard"><h4><span class="cnum">'+g.ch.number+'</span>'+esc(L(bl.label))+'</h4>';
h+='<div class="bctrl"><button class="tbtn'+(isDel?' on':'')+'" onclick="tDel(\''+bl.id+'\')">'+(isDel?'‚úì ':'')+t('del')+'</button></div>';
if(isDel){h+='<p style="color:var(--bl);font-style:italic;font-size:11px">['+t('del')+']</p>'}
else if(!vars.length){h+='<p style="color:var(--txtL);font-size:11px">Vaste tekst ‚Äî geen variabelen.</p>'}
else{h+='<div class="vgrid">';vars.forEach(function(v){
var val=S.vals[bl.id][v.id]||'';var isSup=S.supVars[bl.id][v.id]||false;var isAF=PVM[v.id]&&S.project&&S.project[PVM[v.id]];
var cls=isSup?'vf ss':isAF?'vf af':'vf';var ph=L(v.placeholder)||'';
h+='<div class="'+cls+'"><label>'+esc(L(v.label))+(v.required?' *':'')+'</label>';
if(v.type==='select'){h+='<select onchange="sV(\''+bl.id+'\',\''+v.id+'\',this.value)"'+(isSup?' disabled':'')+'><option value="">‚Äî</option>';(v.options||[]).forEach(function(o){var ov=typeof o==='string'?o:o.value;var ol=typeof o==='string'?o:L(o.label)||o.value;h+='<option value="'+esc(ov)+'"'+(val===ov?' selected':'')+'>'+esc(ol)+'</option>'});h+='</select>'}
else if(v.type==='multiline'){h+='<textarea oninput="sV(\''+bl.id+'\',\''+v.id+'\',this.value)"'+(isSup?' disabled':'')+' placeholder="'+esc(ph)+'">'+esc(val)+'</textarea>'}
else if(v.type==='date'){h+='<input type="date" value="'+esc(val)+'" onchange="sV(\''+bl.id+'\',\''+v.id+'\',this.value)"'+(isSup?' disabled':'')+'>';}
else if(v.type==='number'){h+='<input type="number" value="'+esc(val)+'" placeholder="'+esc(ph)+'" oninput="sV(\''+bl.id+'\',\''+v.id+'\',this.value)"'+(isSup?' disabled':'')+'>';}
else{h+='<input type="text" value="'+esc(val)+'" placeholder="'+esc(ph)+'" oninput="sV(\''+bl.id+'\',\''+v.id+'\',this.value)"'+(isSup?' disabled':'')+'>';}
if(v.supplierCanSpecify!==false)h+='<span class="st" onclick="tSV(\''+bl.id+'\',\''+v.id+'\')">'+(isSup?'‚úì ':'')+t('sup')+'</span>';
h+='</div>'});h+='</div>'}h+='</div>'})});el.innerHTML=h}
function sV(b,v,val){if(!S.vals[b])S.vals[b]={};S.vals[b][v]=val;renderPv()}
function tSV(b,v){if(!S.supVars[b])S.supVars[b]={};S.supVars[b][v]=!S.supVars[b][v];renderMid();renderPv()}
function tDel(b){if(S.delBlocks.has(b))S.delBlocks.delete(b);else S.delBlocks.add(b);renderCh();renderMid();renderPv()}

// PREVIEW
function rTxt(bl){var txt=L(bl.text);return txt.replace(/\{\{(\w+)\}\}/g,function(m,v){if(S.supVars[bl.id]&&S.supVars[bl.id][v])return'<span class="pv sp">['+t('sup')+']</span>';var val=S.vals[bl.id]?S.vals[bl.id][v]:'';if(val)return'<span class="pv f">'+esc(val)+'</span>';return'<span class="pv">'+v+'</span>'})}
function renderPv(){if(!PG08)return;var el=document.getElementById('pv');var sel=[];PG08.chapters.forEach(function(ch){var cb=ch.blocks.filter(function(b){return S.sel.has(b.id)});if(cb.length)sel.push({ch:ch,blocks:cb})});
if(!sel.length){el.innerHTML='<div class="empty-mid"><div class="ei">üìÑ</div><p>'+t('noB')+'</p></div>';return}
var h='';sel.forEach(function(g){h+='<div class="pc">'+g.ch.number+'. '+esc(L(g.ch.title))+'</div>';g.blocks.forEach(function(bl){h+='<div class="pbt">'+esc(L(bl.label))+'</div>';if(S.delBlocks.has(bl.id)){h+='<div class="pdel">['+t('del')+']</div>';return}var txt=rTxt(bl);txt.split('\n').forEach(function(l){var ln=l.trim();if(!ln)return;h+='<div class="'+(ln.charAt(0)==='-'||ln.charAt(0)==='\u2022'?'pb':'pl')+'">'+ln+'</div>'})})});el.innerHTML=h}

// RESIZE
function initResize(){var cL=document.getElementById('col-left'),cR=document.getElementById('col-right'),dL=document.getElementById('dl'),dR=document.getElementById('dr');var a=null,sx=0,sw=0;
function dn(e,s){e.preventDefault();a=s;sx=e.clientX;sw=s==='l'?cL.offsetWidth:cR.offsetWidth;document.body.style.cursor='col-resize';document.body.style.userSelect='none'}
dL.addEventListener('mousedown',function(e){dn(e,'l')});dR.addEventListener('mousedown',function(e){dn(e,'r')});
document.addEventListener('mousemove',function(e){if(!a)return;var dx=e.clientX-sx;if(a==='l')cL.style.width=Math.max(220,Math.min(420,sw+dx))+'px';else cR.style.width=Math.max(240,Math.min(500,sw-dx))+'px'});
document.addEventListener('mouseup',function(){if(a){document.body.style.cursor='';document.body.style.userSelect='';a=null}})}

// WORD EXPORT
var STM_INTRO={nl:'STM Group is gespecialiseerd in staalconstructies, gevelbekleding en montage voor de utiliteitsbouw.\n\nDit document betreft een aanvraag voor offerte (RFQ). Hierin vindt u:\n\u2022  Een omschrijving van de gevraagde werkzaamheden\n\u2022  De technische specificaties en standaarden\n\u2022  De uitgangspunten en randvoorwaarden\n\u2022  De commerci√´le voorwaarden\n\nWij verzoeken u uw aanbieding volledig en conform de gestelde eisen in te dienen.',en:'STM Group specialises in steel structures, cladding and erection.\n\nThis is a Request for Quotation (RFQ).',de:'STM Group ist spezialisiert auf Stahlkonstruktionen und Montage.\n\nDieses Dokument ist eine Angebotsanfrage (RFQ).',sk:'STM Group sa ≈°pecializuje na oceƒæov√© kon≈°trukcie.\n\nTento dokument je ≈æiados≈• o cenov√∫ ponuku.',fa:'⁄Øÿ±ŸàŸá STM ŸÖÿ™ÿÆÿµÿµ ÿØÿ± ÿ≥ÿßÿ≤Ÿá‚ÄåŸáÿß€å ŸÅŸàŸÑÿßÿØ€å ÿßÿ≥ÿ™.'};
function buildIntroXml(){var txt=L(STM_INTRO);var x='<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:color w:val="F94816"/><w:sz w:val="22"/></w:rPr><w:t xml:space="preserve">'+esc(L({nl:'Over dit document',en:'About this document',de:'√úber dieses Dokument',sk:'O tomto dokumente',fa:'ÿØÿ±ÿ®ÿßÿ±Ÿá ÿß€åŸÜ ÿ≥ŸÜÿØ'}))+'</w:t></w:r></w:p>';
txt.split('\n').forEach(function(l){if(!l.trim()){x+='<w:p><w:pPr><w:spacing w:after="20"/></w:pPr></w:p>';return}x+='<w:p><w:pPr><w:spacing w:after="30"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:color w:val="FFFFFF"/><w:sz w:val="16"/></w:rPr><w:t xml:space="preserve">'+esc(l)+'</w:t></w:r></w:p>'});return x}
function resolveTxt(bl){var txt=L(bl.text);return txt.replace(/\{\{(\w+)\}\}/g,function(m,v){if(S.supVars[bl.id]&&S.supVars[bl.id][v])return'['+t('sup')+']';return(S.vals[bl.id]&&S.vals[bl.id][v])||'['+v+']'})}
function buildBodyXml(){if(!PG08)return'';var x='';
x+='<w:p><w:pPr><w:spacing w:after="80"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="20"/></w:rPr><w:t xml:space="preserve">'+esc(t('dS'))+'</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr></w:p>';
PG08.chapters.forEach(function(ch){var cb=ch.blocks.filter(function(b){return S.sel.has(b.id)});if(!cb.length)return;
x+='<w:p><w:pPr><w:spacing w:before="300" w:after="100"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:color w:val="F94816"/><w:sz w:val="26"/></w:rPr><w:t xml:space="preserve">'+esc(ch.number+'. '+L(ch.title))+'</w:t></w:r></w:p>';
cb.forEach(function(bl){
x+='<w:p><w:pPr><w:spacing w:before="140" w:after="40"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:bCs/><w:color w:val="22293B"/><w:sz w:val="20"/></w:rPr><w:t xml:space="preserve">'+esc(L(bl.label))+'</w:t></w:r></w:p>';
if(S.delBlocks.has(bl.id)){x+='<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:i/><w:color w:val="4A90D9"/><w:sz w:val="20"/></w:rPr><w:t xml:space="preserve">['+esc(t('del'))+']</w:t></w:r></w:p>';return}
resolveTxt(bl).split('\n').forEach(function(l){var ln=l.trim();if(!ln){x+='<w:p><w:pPr><w:spacing w:after="20"/></w:pPr></w:p>';return}
var ind=(ln.charAt(0)==='-'||ln.charAt(0)==='\u2022')?'<w:ind w:left="360"/>':'';
x+='<w:p><w:pPr><w:spacing w:after="30" w:line="276" w:lineRule="auto"/>'+ind+'</w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="19"/></w:rPr><w:t xml:space="preserve">'+esc(ln)+'</w:t></w:r></w:p>'})})});
x+='<w:p><w:pPr><w:spacing w:before="200" w:after="60"/></w:pPr></w:p><w:p><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="20"/></w:rPr><w:t xml:space="preserve">'+esc(t('dR'))+'</w:t></w:r></w:p><w:p><w:r><w:rPr><w:rFonts w:ascii="HK Guise" w:hAnsi="HK Guise"/><w:b/><w:sz w:val="20"/></w:rPr><w:t>STM Group</w:t></w:r></w:p>';return x}
function buildTocXml(){if(!PG08)return'';var items=[];PG08.chapters.forEach(function(ch){if(ch.blocks.some(function(b){return S.sel.has(b.id)}))items.push(ch.number+'. '+L(ch.title))});return items.map(function(i){return'<w:p><w:pPr><w:spacing w:after="60"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="20"/></w:rPr><w:t xml:space="preserve">'+esc(i)+'</w:t></w:r></w:p>'}).join('')}

async function exportToWord(){try{
if(!templateData){var r=await fetch('template.docx');if(!r.ok)throw new Error('Template not found');templateData=await r.arrayBuffer()}
var pc=S.project?S.project.nr:'';var pn=S.project?S.project.name:document.getElementById('i-scope').value||'';
var sc=document.getElementById('i-scope').value||'';var rfq=document.getElementById('i-rfq').value||'';var pd=document.getElementById('i-date').value||'';
var dl=S.lang==='de'?'de-DE':S.lang==='en'?'en-GB':S.lang==='sk'?'sk-SK':'nl-NL';
var dateStr=pd?new Date(pd).toLocaleDateString(dl,{day:'numeric',month:'long',year:'numeric'}):'';
var zip=new JSZip();await zip.loadAsync(templateData.slice(0));var dx=await zip.file('word/document.xml').async('text');
var ra=function(x,o,v){while(x.indexOf(o)!==-1)x=x.replace(o,v);return x};
dx=ra(dx,'{{Project name}}',esc(pn));
dx=ra(dx,'{{projectCode}}',esc(pc));
dx=ra(dx,'{{Prjocet code}}+{{scope}}',esc(pc+(sc?' \u2014 '+sc:'')));
dx=ra(dx,'{{rfqNumber}}',esc(rfq));
dx=ra(dx,'{{documentDate}}',esc(dateStr));
var ip='{{Who we are and What the supplier will face in this documet}}';
var ir=new RegExp('<w:p[^>]*>(?:(?!<\\/w:p>)[\\s\\S])*?'+ip.replace(/[{}|[\]\\]/g,'\\$&')+'(?:(?!<\\/w:p>)[\\s\\S])*?<\\/w:p>','g');
dx=dx.replace(ir,buildIntroXml());
var sm=dx.match(/<w:sdtContent>([\s\S]*?)<\/w:sdtContent>/);if(sm)dx=dx.replace(sm[0],'<w:sdtContent>'+buildTocXml()+'</w:sdtContent>');
var tbr=/<w:p[^>]*>(?:(?!<\/w:p>)[\s\S])*?\{\{Text Blocks\}\}(?:(?!<\/w:p>)[\s\S])*?<\/w:p>/;dx=dx.replace(tbr,buildBodyXml());
zip.file('word/document.xml',dx);
var hf=zip.file('word/header1.xml');if(hf){var hx=await hf.async('text');
var hc='<w:p><w:pPr><w:tabs><w:tab w:val="right" w:pos="9072"/></w:tabs></w:pPr><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="14"/></w:rPr><w:t xml:space="preserve">'+esc(pc+': '+rfq)+'</w:t></w:r><w:r><w:tab/></w:r><w:r><w:rPr><w:rFonts w:ascii="HK Guise Light" w:hAnsi="HK Guise Light"/><w:sz w:val="14"/><w:color w:val="F94816"/></w:rPr><w:t xml:space="preserve">Datum: '+esc(dateStr)+'</w:t></w:r></w:p>';
var hm=hx.match(/<w:hdr[^>]*>([\s\S]*)<\/w:hdr>/);if(hm)hx=hx.replace(hm[1],hc);zip.file('word/header1.xml',hx)}
var blob=await zip.generateAsync({type:'blob',mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});
saveAs(blob,'RFQ_'+(pc||'DRAFT')+'_'+(rfq||'0000')+'_'+S.lang.toUpperCase()+'.docx')}catch(e){console.error(e);alert('Export failed: '+e.message)}}

// BLOCK EDITOR
var edActive=null;
function edRenderList(){if(!PG08)return;var el=document.getElementById('ed-chlist'),h='';
PG08.chapters.forEach(function(ch,ci){h+='<div class="ed-ch open"><div class="ed-ch-head" onclick="this.parentElement.classList.toggle(\'open\')"><span class="num">'+ch.number+'</span><span class="ti">'+esc(L(ch.title))+'</span><span class="cnt">'+ch.blocks.length+'</span></div><div class="ed-ch-blocks">';
ch.blocks.forEach(function(bl,bi){var isAct=edActive&&edActive.ci===ci&&edActive.bi===bi;h+='<div class="ed-bl'+(isAct?' active':'')+'" onclick="edOpen('+ci+','+bi+')"><span class="dot '+(bl.defaultOn?'on':'off')+'"></span>'+esc(L(bl.label))+'</div>'});h+='</div></div>'});el.innerHTML=h}
function edOpen(ci,bi){edActive={ci:ci,bi:bi};edRenderList();edRenderPanel()}
function edRenderPanel(){var cnt=document.getElementById('ed-content'),emp=document.getElementById('ed-empty');
if(!edActive){emp.style.display='flex';cnt.style.display='none';return}emp.style.display='none';cnt.style.display='block';
var ch=PG08.chapters[edActive.ci],bl=ch.blocks[edActive.bi];document.getElementById('ed-title').textContent=ch.number+'. '+L(ch.title)+' ‚Üí '+L(bl.label);
if(!bl.comments)bl.comments=[];if(!bl.translationStatus)bl.translationStatus={en:'current',de:'current',sk:'current',fa:'current'};
var h='<div class="ed-card"><h2>'+esc(L(bl.label))+'<span class="badge" style="background:'+(bl.defaultOn?'var(--grL);color:var(--gr)':'#f0f0f0;color:var(--txtL)')+'">'+
(bl.defaultOn?'AAN':'UIT')+'</span>'+(bl.supplierCanSpecify?'<span class="badge" style="background:var(--blL);color:var(--bl)">Supplier can specify</span>':'')+'</h2>';
h+='<div style="display:flex;gap:8px;margin-bottom:12px"><label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer"><input type="checkbox" '+(bl.defaultOn?'checked':'')+' onchange="edTog(\'defaultOn\',this.checked)"> Default AAN</label>';
h+='<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer"><input type="checkbox" '+(bl.supplierCanSpecify?'checked':'')+' onchange="edTog(\'supplierCanSpecify\',this.checked)"> Supplier can specify</label></div>';
h+='<div style="margin-bottom:4px;font-size:10px;font-weight:600;color:var(--dk2);text-transform:uppercase">Dutch text (master)</div>';
h+='<div id="ed-text" class="ed-textarea" contenteditable="true" oninput="edTxtChanged()">'+renderPills(bl.text.nl,bl.variables||[])+'</div>';
h+='<div class="tr-row"><span class="tr-badge ok">üü¢ NL Master</span>';
['en','de','sk','fa'].forEach(function(lang){var st=bl.translationStatus[lang]||'current';h+='<span class="tr-badge '+(st==='current'?'ok':st==='outdated'?'out':'miss')+'">'+lang.toUpperCase()+(st==='outdated'?' ‚ö†':st==='missing'?' ‚úó':' ‚úì')+'</span>'});h+='</div>';
if(bl.variables&&bl.variables.length){h+='<div class="ed-vars"><div class="ed-vars-head">Variables ('+bl.variables.length+')</div>';
bl.variables.forEach(function(v){h+='<div class="ed-var-row"><span class="vname">{{'+v.id+'}}</span><span class="vtype">'+v.type+'</span><span class="vlabel">'+esc(L(v.label))+'</span><span class="vsrc">'+(v.source||'manual')+'</span></div>'});h+='</div>'}
h+='<div class="ed-comments"><div class="ed-comments-head" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display===\'none\'?\'block\':\'none\'">üí¨ Comments ('+bl.comments.length+') ‚ñæ</div><div class="ed-comments-body">';
bl.comments.forEach(function(c){h+='<div class="ed-cmt'+(c.resolved?' resolved':'')+'"><div class="cmt-meta"><b>'+esc(c.author)+'</b> ¬∑ '+c.date+(!c.resolved?' ¬∑ <span style="color:var(--gr);cursor:pointer" onclick="edResolve('+c.id+')">‚úì resolve</span>':'')+'</div>'+esc(c.text)+'</div>'});
h+='<div class="ed-cmt-add"><input id="cmt-author" placeholder="Your name" style="max-width:100px"><input id="cmt-text" placeholder="Add a comment..."><button onclick="edAddCmt()">Add</button></div></div></div>';
if(bl.lastEditedBy)h+='<p style="font-size:9px;color:var(--txtL);margin-top:8px">Last edited: '+bl.lastEditedDate+' by '+esc(bl.lastEditedBy)+'</p>';
h+='</div>';cnt.innerHTML=h}
function renderPills(txt,vars){return txt.replace(/\{\{(\w+)\}\}/g,function(m,id){var isAuto=!!PVM[id];return'<span class="pill'+(isAuto?' auto':'')+'" contenteditable="false" data-var="'+id+'">{{'+id+'}}</span>'}).replace(/\n/g,'<br>')}
function edTxtChanged(){if(!edActive)return;var bl=PG08.chapters[edActive.ci].blocks[edActive.bi];var el=document.getElementById('ed-text');var txt='';
el.childNodes.forEach(function(n){if(n.nodeType===3)txt+=n.textContent;else if(n.tagName==='BR')txt+='\n';else if(n.classList&&n.classList.contains('pill'))txt+='{{'+n.dataset.var+'}}';else txt+=n.textContent});
bl.text.nl=txt;bl.translationStatus={en:'outdated',de:'outdated',sk:'outdated',fa:'outdated'};bl.lastEditedDate=new Date().toISOString().split('T')[0]}
function edTog(prop,val){if(!edActive)return;PG08.chapters[edActive.ci].blocks[edActive.bi][prop]=val;edRenderPanel();edRenderList()}
function edResolve(id){if(!edActive)return;var bl=PG08.chapters[edActive.ci].blocks[edActive.bi];var c=bl.comments.find(function(x){return x.id===id});if(c)c.resolved=true;edRenderPanel()}
function edAddCmt(){if(!edActive)return;var bl=PG08.chapters[edActive.ci].blocks[edActive.bi];var a=document.getElementById('cmt-author').value.trim(),tx=document.getElementById('cmt-text').value.trim();if(!a||!tx)return;bl.comments.push({id:Date.now(),author:a,date:new Date().toISOString().split('T')[0],text:tx,resolved:false});edRenderPanel()}
function edSave(){if(!PG08)return;try{localStorage.setItem('stm_pg08_data',JSON.stringify(PG08));alert('Saved to localStorage!')}catch(e){alert('Save failed: '+e.message)}}
function edExportJson(){if(!PG08)return;var blob=new Blob([JSON.stringify(PG08,null,2)],{type:'application/json'});saveAs(blob,'pg08_beplating_edited.json')}
function edImportJson(){var input=document.createElement('input');input.type='file';input.accept='.json';input.onchange=async function(e){var file=e.target.files[0];if(!file)return;try{var txt=await file.text();PG08=JSON.parse(txt);S.sel.clear();S.vals={};S.supVars={};S.delBlocks.clear();PG08.chapters.forEach(function(ch){ch.blocks.forEach(function(bl){S.vals[bl.id]={};S.supVars[bl.id]={};if(bl.defaultOn)S.sel.add(bl.id)})});if(S.project)autoFill();renderCh();renderMid();renderPv();edRenderList();edActive=null;edRenderPanel();alert('Imported: '+PG08.chapters.length+' chapters')}catch(err){alert('Error: '+err.message)}};input.click()}

function resetAll(){S.sel.clear();S.delBlocks.clear();S.vals={};S.supVars={};if(PG08)PG08.chapters.forEach(function(ch){ch.blocks.forEach(function(bl){S.vals[bl.id]={};S.supVars[bl.id]={};if(bl.defaultOn)S.sel.add(bl.id)})});if(S.project)autoFill();renderCh();renderMid();renderPv()}

async function init(){try{
var pg=await fetch('data/pg08.json'),sp=await fetch('data/suppliers.json');PG08=await pg.json();SUPPLIERS=await sp.json();
var saved=localStorage.getItem('stm_pg08_data');if(saved)try{var d=JSON.parse(saved);if(d.chapters){PG08=d;console.log('Loaded from localStorage')}}catch(e){}
document.getElementById('i-date').value=new Date().toISOString().split('T')[0];
document.getElementById('i-rfq').value='RFQ-'+new Date().getFullYear()+'-'+String(Math.floor(Math.random()*9000)+1000);
PG08.chapters.forEach(function(ch){ch.blocks.forEach(function(bl){S.vals[bl.id]={};S.supVars[bl.id]={};if(bl.defaultOn)S.sel.add(bl.id)})});
buildLang();renderCh();renderMid();renderPv();initResize();
fetch('template.docx').then(function(r){return r.ok?r.arrayBuffer():null}).then(function(d){templateData=d})}catch(e){console.error(e);document.getElementById('ld').innerHTML='<p style="color:var(--o)">Error: '+e.message+'</p>';return}
document.getElementById('ld').style.display='none'}
init();
</script>
</body>
</html>
